<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FV3DYCORE: Chapter4.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="UFSLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FV3DYCORE
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Chapter4_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Chapter4.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Chapter4_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;The vertical Lagrangian Solver {#lagrangian}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;=========================================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;##Chapter 4 </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;GFDL will provide the additional documentation by the end of May 2021.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;(This information is a reproduction of Sections 3 and 4 from HCZC20)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;###4.1 Lagrangian vertical coordinates</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;A *Lagrangian* vertical coordinate is used in FV&lt;sup&gt;3&lt;/sup&gt;. This coordinate uses the depth of each layer (in terms of mass or as geometric height) as a prognostic variable, allowing the layer interfaces to deform freely as the flow evolves. Further, the flow is constrained within the Lagrangian layers, with no flow across the layer interfaces (even for non-adiabatic flows). Instead, the flow deforms the layers themselves by advecting the layer thickness and by straining the layers by the vertical gradient of explicit vertical motion. This form is automatically consistent with the LR96 scheme, avoids the need for explicit calculation and dimensional splitting of verticaladvection, greatly reduces implicit vertical diffusion, and has no vertical Courant number restriction.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;FV&lt;sup&gt;3&lt;/sup&gt; uses a hybrid-pressure coordinate based on the hydrostatic surface pressure \f$p_s^*\f$:</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;\f[</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; p_k^* = a_k + b_kp_s^*  \\  \tag {4.1}</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; \f]</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;where *k* is the vertical index of the layer interface, counting from the top down, and \f$a_k\f$, \f$b_k\f$ are pre-defined coefficients. Typically, the top interface is at a constant pressure \f$p_T\f$, so \f$a_0 = p_T\f$ and \f$b_0 = 0\f$. The spacing of the levels depends on the particular application, and is chosen depending on how high of a model top is desired, where additional vertical resolution is applied (typically in the boundary layer, but sometimes also near the tropical tropopause), and where to transition from hybrid \f$b_k &gt; 0\f$ to pure pressure \f$b_k = 0\f$ coordinates.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;###4.2 Prognostic variables and governing equations</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;The mass per unit area \f$\delta m\f$ can be expressed in terms of the difference in hydrostatic pressure \f$\delta p^*\f$ between the top and bottom of the layers; and, using the hydrostatic equation, can also be written in terms of the layer depth \f$\delta z^1\f$:</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;\f[</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; \delta m = \frac{\delta p^*}{g} = -p \delta z  \\  \tag {4.2} </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  \f]</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;The continuous Lagrangian equations of motion, in a layer of finite depth \f$\delta z\f$ and mass \f$\delta p^*\f$, are then given as</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;\f[</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; D_L \delta p^* + \nabla \cdot (V \delta p^*) = 0  \\</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; D_L \delta p^* \Theta_v + \nabla \cdot (V \delta p^* \Theta_v) = 0  \\</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; D_L \delta p^*w + \nabla \cdot (V \delta p^*w) = -g \delta z \frac{\partial p&#39;}{\partial z}  \\</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; D_L u = \Omega u - \frac{\partial}{\partial x} K - \frac{1}{p} \frac{\partial p}{\partial x} \biggr\rvert_{z} \\</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; D_L v = - \Omega u - \frac{\partial}{\partial y} K - \frac{1}{p} \frac{\partial p}{\partial y} \biggr\rvert_{z}  \\  \tag {4.3}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  \f]</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;Note that these equations are exact: no discretization has been made yet, and the only change from the original differential form of Euler’s equations is to integrate over an arbitrary depth \f$\delta p^*\f$. The operator \f$D_L\f$ is the “vertically-Lagrangian” derivative, formally equal to \f$\frac{\partial \psi}{\partial t} + \frac{\partial}{\partial z}(w \psi)\f$ for an arbitrary scalar \f$\psi\f$. The flow is entirely along the Lagrangian surfaces, including the vertical motion (which deforms the surfaces as appropriate, an effect included in the semi-implicit solver).</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;####Prognostic variables in FV&lt;sup&gt;3&lt;/sup&gt;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;Variable         | Description</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;:--------------: | :---------- </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;\f$\delta p^*\f$ | Vertical difference in hydrostatic pressure, proportional to mass</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;\f$u\f$          | D-grid face-mean horizontal x-direction wind</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;\f$v\f$          | D-grid face-mean horizontal y-direction wind</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;\f$\Theta_v\f$   | Cell-mean virtual potential temperature</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;\f$w\f$          | Cell-mean vertical velocity</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;\f$\delta z\f$   | Geometric layer height</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;The vertical component of absolute vorticity is given as \f$\Omega\f$ and \f$p\f$ is the full nonhydrostatic pressure. The kinetic energy is given as \f$K = \frac{1}{2}(\tilde{u}u + \tilde{v}v)\f$: since FV&lt;sup&gt;3&lt;/sup&gt; does not assume that the horizontal coordinate system is orthogonal, we use the covariant (\f$u\f$ and \f$v\f$) components of the wind vector as prognostic variables and the contravariant (\f$\tilde{u}\f$ and \f$\tilde{v}\f$) components for advection, avoiding the need to explicitly include metric terms. See PL07 and HL13 for more information about covariant and contravariant components.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The nonhydrostatic pressure gradient term in the \f$w\f$ equation is computed by the semi-implicit solver described section 5, which also computes the prognostic equation for \f$\delta z\f$. There is no projection of the vertical pressure gradient force into the horizontal; similarly, there is no projection of the horizontal winds \f$u\f$, \f$v\f$into the vertical, despite the slopes of the Lagrangian surfaces.</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Finally, the ideal gas law:</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;\f[</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; p = p^* + p&#39; = \rho R_dT_v = - \frac{\partial p^*}{g \delta z} R_d T_v  \\  \tag {4.4}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  \f]</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;where</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;\f[</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; T_v = T(1 + \in q_v)(1 - q_{cond})  \\ \tag {4.5}</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  \f]</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;is the “condensate modified” virtual temperature, or density temperature, is used to close the system of equations. Here, \f$d_{cond}\f$ is the (moist) mixingratio of all of the liquid and solid-phase microphysical species, if present. When the gas law is used, the mass \f$p^*\f$ in this computation must be the mass of only the dry air and water vapor, and not including the mass of the condensate (non-gas) species. A rigorous derivation of the virtual and density temperatures is given in K. Emanuel, Atmospheric Convection (1994, Oxford), Sec. 4.3.</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;These equations are also applicable to hydrostatic flow, in which \f$w\f$ is not prognosed and \f$p = p^*\f$  is entirely hydrostatic.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;______________________________</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;&lt;sup&gt;1&lt;/sup&gt; In this document, to avoid confusion we write \f$\delta z\f$ as if it is a positive-definite quantity. In the solver itself, \f$\delta z\f$ is defined to be negative-definite, incorporating the negative sign into the definition of \f$\delta z\f$; this definition has the additional advantage of being consistent with how \f$\delta z\f$ is defined, being measured as the difference in hydrostatic pressure between the bottom and top of a layer.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Chapter4_8md.html">Chapter4.md</a></li>
    <li class="footer">Generated on Wed Feb 24 2021 08:04:36 for FV3DYCORE by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
