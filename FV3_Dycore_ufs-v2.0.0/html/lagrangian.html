<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FV3DYCORE: The vertical Lagrangian Solver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="UFSLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FV3DYCORE
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lagrangian.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The vertical Lagrangian Solver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Chapter 4</h2>
<p>GFDL will provide the additional documentation by the end of May 2021.</p>
<p>(This information is a reproduction of Sections 3 and 4 from HCZC20)</p>
<h3>4.1 Lagrangian vertical coordinates</h3>
<p>A <em>Lagrangian</em> vertical coordinate is used in FV<sup>3</sup>. This coordinate uses the depth of each layer (in terms of mass or as geometric height) as a prognostic variable, allowing the layer interfaces to deform freely as the flow evolves. Further, the flow is constrained within the Lagrangian layers, with no flow across the layer interfaces (even for non-adiabatic flows). Instead, the flow deforms the layers themselves by advecting the layer thickness and by straining the layers by the vertical gradient of explicit vertical motion. This form is automatically consistent with the LR96 scheme, avoids the need for explicit calculation and dimensional splitting of verticaladvection, greatly reduces implicit vertical diffusion, and has no vertical Courant number restriction.</p>
<p>FV<sup>3</sup> uses a hybrid-pressure coordinate based on the hydrostatic surface pressure \(p_s^*\):</p>
<p class="formulaDsp">
\[ p_k^* = a_k + b_kp_s^* \\ \tag {4.1} \]
</p>
<p>where <em>k</em> is the vertical index of the layer interface, counting from the top down, and \(a_k\), \(b_k\) are pre-defined coefficients. Typically, the top interface is at a constant pressure \(p_T\), so \(a_0 = p_T\) and \(b_0 = 0\). The spacing of the levels depends on the particular application, and is chosen depending on how high of a model top is desired, where additional vertical resolution is applied (typically in the boundary layer, but sometimes also near the tropical tropopause), and where to transition from hybrid \(b_k &gt; 0\) to pure pressure \(b_k = 0\) coordinates.</p>
<h3>4.2 Prognostic variables and governing equations</h3>
<p>The mass per unit area \(\delta m\) can be expressed in terms of the difference in hydrostatic pressure \(\delta p^*\) between the top and bottom of the layers; and, using the hydrostatic equation, can also be written in terms of the layer depth \(\delta z^1\):</p>
<p class="formulaDsp">
\[ \delta m = \frac{\delta p^*}{g} = -p \delta z \\ \tag {4.2} \]
</p>
<p>The continuous Lagrangian equations of motion, in a layer of finite depth \(\delta z\) and mass \(\delta p^*\), are then given as</p>
<p class="formulaDsp">
\[ D_L \delta p^* + \nabla \cdot (V \delta p^*) = 0 \\ D_L \delta p^* \Theta_v + \nabla \cdot (V \delta p^* \Theta_v) = 0 \\ D_L \delta p^*w + \nabla \cdot (V \delta p^*w) = -g \delta z \frac{\partial p&#39;}{\partial z} \\ D_L u = \Omega u - \frac{\partial}{\partial x} K - \frac{1}{p} \frac{\partial p}{\partial x} \biggr\rvert_{z} \\ D_L v = - \Omega u - \frac{\partial}{\partial y} K - \frac{1}{p} \frac{\partial p}{\partial y} \biggr\rvert_{z} \\ \tag {4.3} \]
</p>
<p>Note that these equations are exact: no discretization has been made yet, and the only change from the original differential form of Euler’s equations is to integrate over an arbitrary depth \(\delta p^*\). The operator \(D_L\) is the “vertically-Lagrangian” derivative, formally equal to \(\frac{\partial \psi}{\partial t} + \frac{\partial}{\partial z}(w \psi)\) for an arbitrary scalar \(\psi\). The flow is entirely along the Lagrangian surfaces, including the vertical motion (which deforms the surfaces as appropriate, an effect included in the semi-implicit solver).</p>
<h4>Prognostic variables in FV<sup>3</sup></h4>
<table class="doxtable">
<tr>
<th align="center">Variable </th><th align="left">Description  </th></tr>
<tr>
<td align="center">\(\delta p^*\) </td><td align="left">Vertical difference in hydrostatic pressure, proportional to mass </td></tr>
<tr>
<td align="center">\(u\) </td><td align="left">D-grid face-mean horizontal x-direction wind </td></tr>
<tr>
<td align="center">\(v\) </td><td align="left">D-grid face-mean horizontal y-direction wind </td></tr>
<tr>
<td align="center">\(\Theta_v\) </td><td align="left">Cell-mean virtual potential temperature </td></tr>
<tr>
<td align="center">\(w\) </td><td align="left">Cell-mean vertical velocity </td></tr>
<tr>
<td align="center">\(\delta z\) </td><td align="left">Geometric layer height </td></tr>
</table>
<p>The vertical component of absolute vorticity is given as \(\Omega\) and \(p\) is the full nonhydrostatic pressure. The kinetic energy is given as \(K = \frac{1}{2}(\tilde{u}u + \tilde{v}v)\): since FV<sup>3</sup> does not assume that the horizontal coordinate system is orthogonal, we use the covariant ( \(u\) and \(v\)) components of the wind vector as prognostic variables and the contravariant ( \(\tilde{u}\) and \(\tilde{v}\)) components for advection, avoiding the need to explicitly include metric terms. See PL07 and HL13 for more information about covariant and contravariant components.</p>
<p>The nonhydrostatic pressure gradient term in the \(w\) equation is computed by the semi-implicit solver described section 5, which also computes the prognostic equation for \(\delta z\). There is no projection of the vertical pressure gradient force into the horizontal; similarly, there is no projection of the horizontal winds \(u\), \(v\)into the vertical, despite the slopes of the Lagrangian surfaces.</p>
<p>Finally, the ideal gas law:</p>
<p class="formulaDsp">
\[ p = p^* + p&#39; = \rho R_dT_v = - \frac{\partial p^*}{g \delta z} R_d T_v \\ \tag {4.4} \]
</p>
<p>where</p>
<p class="formulaDsp">
\[ T_v = T(1 + \in q_v)(1 - q_{cond}) \\ \tag {4.5} \]
</p>
<p>is the “condensate modified” virtual temperature, or density temperature, is used to close the system of equations. Here, \(d_{cond}\) is the (moist) mixingratio of all of the liquid and solid-phase microphysical species, if present. When the gas law is used, the mass \(p^*\) in this computation must be the mass of only the dry air and water vapor, and not including the mass of the condensate (non-gas) species. A rigorous derivation of the virtual and density temperatures is given in K. Emanuel, Atmospheric Convection (1994, Oxford), Sec. 4.3.</p>
<p>These equations are also applicable to hydrostatic flow, in which \(w\) is not prognosed and \(p = p^*\) is entirely hydrostatic.</p>
<hr/>
<p> <sup>1</sup> In this document, to avoid confusion we write \(\delta z\) as if it is a positive-definite quantity. In the solver itself, \(\delta z\) is defined to be negative-definite, incorporating the negative sign into the definition of \(\delta z\); this definition has the additional advantage of being consistent with how \(\delta z\) is defined, being measured as the difference in hydrostatic pressure between the bottom and top of a layer. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 24 2021 08:04:37 for FV3DYCORE by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
