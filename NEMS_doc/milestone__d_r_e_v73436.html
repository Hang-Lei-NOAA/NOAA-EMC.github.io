<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NEMS: DREV73436: WAM-IPE 0.2 Send Analytical Fields from WAM to IPE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">master@eee10ef0fe</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('milestone__d_r_e_v73436.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DREV73436: WAM-IPE 0.2 Send Analytical Fields from WAM to IPE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section date"><dt>Date</dt><dd>04/04/2016</dd></dl>
<h2>Repository URL </h2>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/ipe/WAM-IPE">https://svnemc.ncep.noaa.gov/projects/ipe/WAM-IPE</a></li>
</ul>
<h2>Description </h2>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>make IPE pages</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>make WAM pages</dd></dl>
<p>This milestone is an internal release of a NEMS application with one active component and one data component. The active component is the <a href="https://esgf.esrl.noaa.gov/projects/wam_ipe/IPE">Ionosphere Plasmasphere Electrodynamics (IPE)</a> model. The data component is the data version of the <a href="https://esgf.esrl.noaa.gov/projects/wam_ipe/WAM">Whole Atmosphere Model (WAM)</a>. The name of the data component is DATAWAM. All field exchanges in the system occur through the <a class="el" href="sw_mediator.html">space weather mediator</a>. This is a technical (non-scientific) milestone to ensure that field data is passed correctly from WAM through the mediator and then down through the IPE cap to the model itself. In this milestone, analytic fields are used to validate the transfer of data, so the data coming into IPE from mediator isn't physically correct. Therefore, the output from IPE is not expected to be realistic. In this revision DATAWAM runs on a global 3D reduced Gaussian grid (<a class="el" href="_g_r_i_d_wam.html">WAM grid</a>). The horizontal resolution is T62. The vertical component of this grid is 150 levels in pressure and has to be converted to height in order to couple with IPE. Because the relationship between pressure and height varies during a run, the actual heights of the levels of the WAM grid varies during a run. The maximum height of the WAM grid is approximately 800 km. In this revision IPE runs on an 80 x 170 flux tube grid (<a class="el" href="_g_r_i_d__i_p_e.html">IPE grid</a>) that extends up to approximately 360,000 km. Because of the difference in heights, the WAM grid only overlaps with the bottom of the IPE grid. The amount of the overlap depends on the current height of the WAM grid.</p>
<p>NUOPC "caps", which are essentially wrappers for the coupling interface, are provided for all model components allowing these components to work in NEMS and other NUOPC-compliant systems. The version of each component used is:</p>
<ul>
<li>DATAWAM</li>
<li>IPE</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>add pages for DATAWAM and IPE</dd></dl>
<p>In this release only a subset of possible fields are exchanged between DATAWAM and IPE. The <a href="http://docs.google.com/spreadsheets/d/1ThbEHNh2ZV7PMdcsitEt4wz5CZkojlANK4hszkLdNAs/edit#gid=0">coupling fields spreadsheet</a> indicates in detail the status of the different coupled fields.</p>
<ul>
<li>DATAWAM fields are built to simulate output from WAM. To do this they are built on a 2D unstructured mesh which represents the 2D shuffled reduced-Gaussian grid of the WAM model. The 2D WAM information (e.g. coordinates) used to construct this grid are read in from a file. DATAWAM exports height information as a 3D field built on the 2D grid. The WAM model's vertical coordinate is at fixed pressure levels, so its actual height varies time-step by time-step. To simulate this variation, DATAWAM's height field is generated analytically every time-step using a random number generator. The data fields output by DATAWAM are filled with an analytic function so that the quality of the transfer can be checked in IPE.</li>
<li>The IPE input fields advertised only represent a subset of the full fields used by IPE. The reason for this is that the WAM and IPE grids only overlap at the bottom of the IPE grid. Transferring the entire IPE grid to the mediator would be inefficient, so only the part that potentially overlaps with WAM is transferred and used for regridding. In the IPE cap the fields received from the mediator are copied into a variable (wamfield) which has the full index space of the IPE fields. This transfer is complex because both representations of the data are collapsed to 1D for efficiency's sake. Once in the wamfield variable the data is extrapolated to fill the empty region. If acting as part of a coupled system, IPE uses the data from wamfield as part of it's computations. In this technical milestone, we will examine the data in wamfield to verify that it was transferred correctly from DATAWAM.</li>
</ul>
<h2>Build &amp; Run </h2>
<p>Instructions on how to build and run specific code revisions (e.g. this milestone revision) and the supported compsets are provided on the <a href="https://esgf.esrl.noaa.gov/projects/wam_ipe/build_run">WAM-IPE Build &amp; Run</a> page.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>migrate WAM-IPE Build &amp; Run page</dd></dl>
<h2>Run Sequence </h2>
<p>The NEMS run-time configuration for the default Regional configuration is provided below. For details on the run sequence in general please refer to the <a class="el" href="configuring.html">Configuring</a> and <a class="el" href="architecture.html">Architecture</a> pages. </p><pre class="fragment">runSeq::
 @21600.0
   ATM -&gt; MED :remapMethod=redist
   MED
   MED -&gt; IPM :remapMethod=redist
   ATM
   IPM
 @
::
</pre><h2>Validation </h2>
<p>The validation procedure for this milestone is to verify the correct transfer of analytic fields from DATAWAM to IPE. This transfer includes redistribution from DATAWAM to the mediator, regridding in the mediator, redistribution from the mediator to the IPE cap and then the connection from the IPE cap to the model itself. To verify the connection, the average relative error is computed between the transferred field in the IPE model and the exact analytic value that it was set to in DATAWAM. If this error is equal to or smaller than the expected maxium error (1.0E-4) then the transfer is considered correct.</p>
<p>The analytic function used for the validation is the function F=cos(lat)2 *cos(2*lon) + 0.004*height + 1.0 where (lat,lon) are the latitude and longitude coordinates of the points and height is the height of the point in km.</p>
<p>During this test both components run for a two day simulation, coupling every six hours.</p>
<p>A test report is available for the validation run:</p>
<ul>
<li><a href="https://esgf.esrl.noaa.gov/projects/couplednems/IPE_Cap_Integration_Test_Report">Space Weather One-Way Connection to IPE Test Report.</a></li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd>move Space Weather One-Way Connection to IPE Test Report to vlab</dd></dl>
<p>The following table summarizes the test results for each field.</p>
<table class="doxtable">
<tr>
<th align="left">Field </th><th align="center">Source Grid </th><th align="center">Destination Grid </th><th align="center">Average Relative Error </th><th align="center">Status  </th></tr>
<tr>
<td align="left">northward_wind_neutral </td><td align="center">WAM T62 Reduced Gaussian Grid </td><td align="center">IPE 80 x 170 Flux Tube Grid </td><td align="center">7.96E-5 </td><td align="center">OK </td></tr>
<tr>
<td align="left">eastward_wind_neutral </td><td align="center">WAM T62 Reduced Gaussian Grid </td><td align="center">IPE 80 x 170 Flux Tube Grid </td><td align="center">7.96E-5 </td><td align="center">OK </td></tr>
<tr>
<td align="left">temp_neutral </td><td align="center">WAM T62 Reduced Gaussian Grid </td><td align="center">IPE 80 x 170 Flux Tube Grid </td><td align="center">7.96E-5 </td><td align="center">OK </td></tr>
</table>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>reference the above grids</dd></dl>
<p>In addition to analytically validating the transfer of all the fields, a visual verification was performed on one field (northward_wind_neutral) as a sanity check. The following two images are from that verification. The top image is of the field at a height of 104 km in WAM. The bottom image is of the same field at the same height in IPE after being transferred from WAM. Each image is a plot of the points making up the field with the color indicating the field's values. This type of plot was used to show the difference in the grids as well as the values. Because of the different positions of the points in the two plots, there is the appearance of some distortion in the fields. However, after examining the images, the conclusion was that the transfer happened correctly.</p>
<div class="image">
<img src="DREV73436-WAM_Field.png" alt="DREV73436-WAM_Field.png"/>
</div>
<div class="image">
<img src="DREV73436-IPE_Field.png" alt="DREV73436-IPE_Field.png"/>
</div>
<h2>Limitations and Technical Notes </h2>
<p>This milestone is purely a verification of the transfer of data. Since the data being transferred into the IPE model isn't physically correct, IPE isn't expected to produce realistic output. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
