<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NEMS: DREV93202: UGCS-Seasonal 0.5</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">master@fb387d39b5</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('milestone__d_r_e_v93202.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DREV93202: UGCS-Seasonal 0.5 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section date"><dt>Date</dt><dd>5/24/2017</dd></dl>
<h2>Repository URL </h2>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Seasonal/branches/external_land">https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Seasonal/branches/external_land</a></li>
</ul>
<p>Subversion Revision: r93202</p>
<h2>Description </h2>
<p>This milestone is a version of the atmosphere-ocean-ice coupled UGCS-Seasonal application with the addition of external land surface (LIS/Noah 3.3) and hydrology (WRF-Hydro) components. The land surface and hydrology components are one-way coupled, receiving their import states from the NEMS Mediator. LIS/Noah 3.3 runs on a global T574 domain and WRF-Hydro runs on a <a class="el" href="_g_r_i_d__front__range__regional.html">small regional grid</a>. The ATM-OCN-ICE components are initialized with April 1, 2015 CFSR-based initial conditions. No spin-up run has been completed for the land surface and hydrology components, so both LIS and WRF-Hydro are initialized with cold start conditions.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000027">Todo:</a></b></dt><dd>reference grids</dd></dl>
<p>This is a follow-on to the <a class="el" href="milestone__d_r_e_v70089.html">Reg-Hydro 0.2 release</a> with the following changes:</p>
<ul>
<li>The separate atmosphere layer (NEMS/src/atmos) originally in NEMS has been removed and GSM is using its own NUOPC cap. This was accomplished by branching off of the ATM-refactor branch.</li>
<li>A complete set of coupling fields are sent from the Mediator to LIS and WRF-Hydro. Previously, only a subset of fields were transferred to validate grid interpolation.</li>
<li>GSM is in semi-Lagrangian mode on the T574 grid. The previous milestone used the Eulerian dycore on the T126 grid.</li>
<li>CICE and MOM use <a class="el" href="_g_r_i_d_mom5_0p5deg_tripole.html">0.5 degree tripolar grids</a>. The previous milestone used 1 degree tripolar grids.</li>
<li>LIS is running on the reduced T574 grid with coldstart initial values. The previous milestone ran on the T126 grid. New configuration options have been added to the LIS cap including: the ability to write NUOPC state restart files, log optimizations, compilation with debugging.</li>
<li>WRF-Hydro continues to run on the Front Range regional domain with coldstart initial values. New configuration options have been added to the WRF-Hydro cap including: the ability to write NUOPC state restart files, log optimizations, and compilation with debugging</li>
</ul>
<p>The milestone has been validated by (1) ensuring that the original three-way coupled system produces physically realistic mediator restart files, (2) validating the quality of the regridding between ATM-&gt;LND and LND-&gt;HYD in the Mediator, and (3) verifying that the LIS/Noah 3.3 and WRF-Hydro produce physically releastic output from cold start conditions after 1 day and 5 day runs.</p>
<p>The release is available on the "external_land" branch listed above. No effort was made to merge back to the trunk due to recent significant NEMS build/run infrastructure changes.</p>
<h2>Run Sequences </h2>
<p>UGCS-Seasonal includes two run sequences, a cold start sequence and a time integration sequence.</p>
<p><b>Cold start sequence</b>: The first cold start sequence initializes components using a minimal set of files ingested by GSM. The cold start sequence only needs to run for a half hour. However, it runs for an hour because there is a limitation on running less than an hour in EMC scripts. </p><pre class="fragment">runSeq::
  @1800.0
    @600.0
      MED MedPhase_prep_atm
      MED -&gt; ATM :remapMethod=redist
      ATM
      ATM -&gt; MED :remapMethod=redist
      MED MedPhase_prep_lnd
      MED -&gt; LND :remapMethod=redist
      LND
      LND -&gt; MED :remapMethod=redist
      MED MedPhase_prep_hyd
      MED -&gt; HYD :remapMethod=redist
      HYD
      HYD -&gt; MED :remapMethod=redist
      MED MedPhase_prep_ice
      MED -&gt; ICE :remapMethod=redist
      ICE
      ICE -&gt; MED :remapMethod=redist
      MED MedPhase_atm_ocn_flux
      MED MedPhase_accum_fast
    @
    MED MedPhase_prep_ocn
    MED -&gt; OCN :remapMethod=redist
    OCN
    OCN -&gt; MED :remapMethod=redist
  @
::
</pre><p><b>Time integration sequence</b>: The second run sequence, shown below, is for the time integration loop. It is initialized by restart files generated by the cold start sequence. There is a fast and a slow loop, at 10 minutes and 30 minutes, respectively. </p><pre class="fragment">runSeq::
  @1800.0
    MED MedPhase_prep_ocn
    MED -&gt; OCN :remapMethod=redist
    OCN
    @600.0
      MED MedPhase_prep_ice
      MED MedPhase_prep_hyd
      MED MedPhase_prep_lnd
      MED MedPhase_prep_atm
      MED -&gt; ATM :remapMethod=redist
      MED -&gt; LND :remapMethod=redist
      MED -&gt; HYD :remapMethod=redist
      MED -&gt; ICE :remapMethod=redist
      ATM
      LND
      HYD
      ICE
      ATM -&gt; MED :remapMethod=redist
      LND -&gt; MED :remapMethod=redist
      HYD -&gt; MED :remapMethod=redist
      ICE -&gt; MED :remapMethod=redist
      MED MedPhase_atm_ocn_flux
      MED MedPhase_accum_fast
    @
    OCN -&gt; MED :remapMethod=redist
    MED MedPhase_write_restart
  @
::
</pre><h2>New Coupling Fields </h2>
<h3>Mediator to LIS</h3>
<table class="doxtable">
<tr>
<th align="left">Standard Name </th><th align="left">Units </th><th align="left">Interpolation Method  </th></tr>
<tr>
<td align="left">inst_down_lw_flx </td><td align="left">W m-2 </td><td align="left">conservative </td></tr>
<tr>
<td align="left">inst_down_sw_flx </td><td align="left">W m-2 </td><td align="left">conservative </td></tr>
<tr>
<td align="left">inst_merid_wind_height_lowest </td><td align="left">m s-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">inst_pres_height_surface </td><td align="left">Pa </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">inst_spec_humid_height_lowest </td><td align="left">kg kg-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">inst_temp_height_lowest </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">inst_zonal_wind_height_lowest </td><td align="left">m s-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">mean_prec_rate </td><td align="left">kg m-2 s-1 </td><td align="left">conservative </td></tr>
</table>
<h3>LIS to Mediator</h3>
<table class="doxtable">
<tr>
<th align="left">Standard Name </th><th align="left">Units </th><th align="left">Interpolation Method  </th></tr>
<tr>
<td align="left">temperature_of_soil_layer_1 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_2 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_3 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_4 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_1 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_2 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_3 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_4 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_1 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_2 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_3 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_4 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">surface_runoff_flux </td><td align="left">m s-1 </td><td align="left">conservative </td></tr>
<tr>
<td align="left">subsurface_runoff_flux </td><td align="left">m s-1 </td><td align="left">conservative </td></tr>
</table>
<h3>Mediator to WRF-Hydro</h3>
<table class="doxtable">
<tr>
<th align="left">Standard Name </th><th align="left">Units </th><th align="left">Interpolation Method  </th></tr>
<tr>
<td align="left">temperature_of_soil_layer_1 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_2 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_3 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">temperature_of_soil_layer_4 </td><td align="left">K </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_1 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_2 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_3 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">moisture_content_of_soil_layer_4 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_1 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_2 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_3 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">liquid_water_content_of_soil_layer_4 </td><td align="left">m m-1 </td><td align="left">bilinear </td></tr>
<tr>
<td align="left">surface_runoff_flux </td><td align="left">m s-1 </td><td align="left">conservative </td></tr>
<tr>
<td align="left">subsurface_runoff_flux </td><td align="left">m s-1 </td><td align="left">conservative </td></tr>
</table>
<h2>Validation </h2>
<p>UGCS-Seasonal 0.5 did not bit-for-bit reproduce the NEMS mediator restart files generated from the Atm Refactor work or the NEMS mediator restart files generated from <a class="el" href="milestone__d_r_e_v88884.html">UGCS-Seasonal 0.4</a>. Note that the Atm Refactor work also did not bit-for-bit reproduce the NEMS mediator restart files generated from <a class="el" href="milestone__d_r_e_v88884.html">UGCS-Seasonal 0.4</a>. There have been changes made to the NEMS run system that are likely to link in different initialization conditions. Milestone validation was carried out through</p>
<ol type="1">
<li>Producing data plots of all ATM-LND and LND-HYD coupled fields and inspecting the regridding.</li>
<li>Producing data plots of LIS output including all eight Noah.3.3 meterological forcing fields, soil temperatures, soil moisture content, liquid fraction of soil moisture content, and runoff.</li>
<li>Producing data plots of WRF-Hydro output including streamflow.</li>
</ol>
<h3>NEMS Mediator Regridding Samples (2015-04-01:00:01:00)</h3>
<div class="image">
<img src="DREV93202-shade_MED_FROM_ATM_inst_temp_height_lowest_4.gif" alt="DREV93202-shade_MED_FROM_ATM_inst_temp_height_lowest_4.gif"/>
</div>
 <div class="image">
<img src="DREV93202-shade_MED_TO_HYD_temperature_of_soil_layer_1_4.gif" alt="DREV93202-shade_MED_TO_HYD_temperature_of_soil_layer_1_4.gif"/>
</div>
<h3>NEMS Mediator End of Run Samples (2015-04-06:00:00:00)</h3>
<div class="image">
<img src="DREV93202-shade_MEDIATOR_inst_spec_humid_height_lowest_1.gif" alt="DREV93202-shade_MEDIATOR_inst_spec_humid_height_lowest_1.gif"/>
</div>
 <div class="image">
<img src="DREV93202-shade_MEDIATOR_moisture_content_of_soil_layer_1_1.gif" alt="DREV93202-shade_MEDIATOR_moisture_content_of_soil_layer_1_1.gif"/>
</div>
<h3>LIS Output End of Run Samples (2015-04-06:00:00:00)</h3>
<div class="image">
<img src="DREV93202-shade_LIS_Qair_f_tavg_1.gif" alt="DREV93202-shade_LIS_Qair_f_tavg_1.gif"/>
</div>
 <div class="image">
<img src="DREV93202-shade_LIS_SoilMoist_tavg_1.gif" alt="DREV93202-shade_LIS_SoilMoist_tavg_1.gif"/>
</div>
<h3>WRF-Hydro Output End of Run Samples (2015-04-06:00:00:00)</h3>
<div class="image">
<img src="DREV93202-streamflow.gif" alt="DREV93202-streamflow.gif"/>
</div>
<p>Sample Plots: <a href="https://esgf.esrl.noaa.gov/projects/couplednems/ugcs-seasonal_0_5_plots">https://esgf.esrl.noaa.gov/projects/couplednems/ugcs-seasonal_0_5_plots</a></p>
<h2>Download, Build, Run, and Restart </h2>
<h3>Download and Build</h3>
<p>To check out and build the application: </p><pre class="fragment">svn co -r92981 https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Seasonal/branches/external_land UGCS_seasonal_0_5
cd UGCS_seasonal_0_5
./NEMS/NEMSAppBuilder
</pre><p>General instructions on how to download and build a NEMS application are discussed in section 1.1.1 and 1.1.2 in the NEMS User's Guide and Reference.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000028">Todo:</a></b></dt><dd>Update guide reference when the guide is finished</dd></dl>
<h3>Cold Start, 1 Day Run, and 5 Day Run</h3>
<p>Compsets that can be run with this revision are:</p>
<p>Coupled </p><pre class="fragment">cfsr%20150401_1hr_nems%cold_gsm%slg%T574_lis%T574_wrfhydro%frontrange_cice%0.5_mom5%0.5
cfsr%20150401_1day_nems_gsm%slg%T574_lis%T574_wrfhydro%frontrange_cice%0.5_mom5%0.5
cfsr%20150401_5day_nems_gsm%slg%T574_lis%T574_wrfhydro%frontrange_cice%0.5_mom5%0.5
</pre><p>Side-by-Side/Standalone </p><pre class="fragment">cfsr%20150401_1day_sbys_lis%T574
cfsr%20150401_1day_sbys_wrfhydro%frontrange
</pre><p>To run the default UGCS-Seasonal compset list, use this command from the app directory: </p><pre class="fragment">./NEMS/NEMSCompsetRun
</pre><p>Note: The default UGCS-Seasonal compset list includes the 1 hour coldstart and 1 day restart. In order to run the 5 day restart or the 30 day restart please change the QUEUE value set in NEMS/NEMSCompsetRun</p>
<p>To run a specific compset: </p><pre class="fragment">./NEMS/NEMSCompsetRun -compset &lt;compset name&gt;
</pre><p>Note: In order to run the 5 day restart or the 30 day restart please change the QUEUE value set in NEMS/NEMSCompsetRun</p>
<h2>Mediator Restart Files </h2>
<p>The NEMS Mediator is capable of reading in a set of restart files containing initial values of coupling fields. This is required in order to run components concurrently. NEMS Mediator restart files are provided on Theia as part of this release, so it is not required to generate new restart files. However, the process is documented below in case new restarts need to be generated. Note this is the same process as is documented in the <a class="el" href="milestone__d_r_e_v88884.html">UGCS-Seasonal 0.4</a> release.</p>
<dl class="section note"><dt>Note</dt><dd>NEMS Mediator restart files are provided on Theia as part of this release, so it is not required to generate new restart files. However, the process is documented below in case new restarts need to be generated. Note this is the same process as is documented in the <a class="el" href="milestone__d_r_e_v88884.html">UGCS-Seasonal 0.4</a> release.</dd></dl>
<p>To initialize a new case of the UGCS-Seasonal from a cold start, run the cold start compset, <code>cfsr%20150401_1hr_nemscold_gsmslgT574_lisT574_wrfhydrofrontrange_cice%0.5_mom5%0.5</code>, to generate initial mediator restart files. This compset runs the atm/land/hyd/ice/ocean sequentially for 1 hour. It will generate some initial mediator restart files consisting of initial values for coupling fields consistent with the current atmosphere, ocean, sea ice, land, and hydrology conditions. You then use those initial mediator files to startup a standard run with the same model initial conditions and initial model date as the cold start run. To do this, run the coldstart compset using CompsetRun as specified above with the compset, <code>cfsr%20150401_1day_nems_gsmslgT574_lisT574_wrfhydrofrontrange_cice%0.5_mom5%0.5</code>.</p>
<p>After running the cold start compset, go into NEMS/NEMSCompsetRun and modify "setup_med_nems" to pre-stage the cold start mediator restart files instead of whatever files are set by default. This is done in a section that looks like: </p><pre class="fragment">cp -f ${DATADIR}/MED_NEMS/${nemsgrid}${nemsgridinp}/* ${RUNDIR}
# cp -f /scratch3/NCEPDEV/stmp1/Anthony.Craig/UGCS-Seasonal.r72808/20150401short_nemscold_gsm_cice_mom5/mediator*restart* ${RUNDIR}
</pre><p>(You will need to adjust the copy from path to your coldstart run directory.)</p>
<p>Comment out the first line and uncomment the second line. In the second line, set the path to the cold start run directory where the cold start case just ran. This will copy the mediator restart files from your cold start run directory into the new run directory.</p>
<p>Once the cold start is done and the NEMSCompsetRun is modified, run a standard compset like cfsr%20150401_1day_nems_gsmslgT574_lisT574_wrfhydrofrontrange_cice%0.5_mom5%0.5 to advance the model from the initial conditions. The system will start with the same atmosphere, ocean, and ice initial conditions as the cold start run plus the new mediator restart files, and the model will run concurrently. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
