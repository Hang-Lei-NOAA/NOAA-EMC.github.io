<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NEMS: Notes for NEMS Code Managers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">master@2db048d501</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('code-manager-notes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Notes for NEMS Code Managers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page serves as a "notebook" for keeping information needed for personnel to manage the NEMS code. It is mainly targetted to the NEMS Code Manager, but may be of use to other code managers as well.</p>
<h2>NEMS Compset Data Locations </h2>
<p>The NEMS compset data, also known as regression test data, is stored in specific locations on each NOAA machine. There is a directory structure like so:</p>
<ul>
<li>/path/to/RT<ul>
<li>/path/to/RT/app-name<ul>
<li>/path/to/RT/app-name/branch-20190919</li>
<li>/path/to/RT/app-name/branch-20191223</li>
<li>/path/to/RT/app-name/another-branch-20190918</li>
</ul>
</li>
<li>/path/to/RT/another-app<ul>
<li>/path/to/RT/app-name/branch-20190825</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If the branch name in the filename is "trunk," then it is actually for the "master" branch. The "trunk" directory name was retained for continuity after the transition to Subversion in 2018.</p>
<p>The "RT" directory is in these locations:</p>
<table class="doxtable">
<tr>
<th>Machine </th><th>Directory  </th></tr>
<tr>
<td>WCOSS Phase 1 </td><td><code>/nems/noscrub/emc.nemspara/RT</code> </td></tr>
<tr>
<td>WCOSS Phase 2 </td><td><code>/nems/noscrub/emc.nemspara/RT</code> </td></tr>
<tr>
<td>WCOSS Cray </td><td><code>/gpfs/hps3/emc/nems/noscrub/emc.nemspara/RT</code> </td></tr>
<tr>
<td>WCOSS Phase 3 </td><td><code>/gpfs/dell2/emc/modeling/noscrub/emc.nemspara/RT</code> </td></tr>
<tr>
<td>Jet </td><td><code>/lfs3/projects/hfv3gfs/emc.nemspara/RT</code> </td></tr>
<tr>
<td>Theia </td><td><code>/scratch4/NCEPDEV/nems/noscrub/emc.nemspara/RT</code> </td></tr>
<tr>
<td>GAEA </td><td><code>/lustre/f1/pdata/ncep_shared/emc.nemspara/RT</code> </td></tr>
</table>
<p>The GAEA directory is simply a mirror of the contents of the WCOSS Cray directory because those machines get identical results. Thus, the files are copied via a relay through Jet. </p><pre class="fragment">emc.nemspara@jet&gt; mkdir -p /lfs3/projects/hfv3gfs/emc.nemspara/wcoss-NEMSfv3gfs-YYYYMMDDHH
emc.nemspara@surge&gt; cd /gpfs/hps3/emc/nems/noscrub/emc.nemspara/RT/NEMSfv3gfs/trunk-YYYYMMDDHH
emc.nemspara@surge&gt; rsync -arv . jetscp.rdhpcs.noaa.gov:/lfs3/projects/hfv3gfs/emc.nemspara/wcoss-NEMSfv3gfs-YYYYMMDDHH/.
emc.nemspara@gaea&gt; mkdir -p /lustre/f1/pdata/ncep_shared/emc.nemspara/RT/trunk-YYYYMMDDHH
emc.nemspara@gaea&gt; cd /lustre/f1/pdata/ncep_shared/emc.nemspara/RT/trunk-YYYYMMDDHH
emc.nemspara@gaea&gt; rsync -arv jetscp.rdhpcs.noaa.gov:/lfs3/projects/hfv3gfs/emc.nemspara/wcoss-NEMSfv3gfs-YYYYMMDDHH/. .
</pre><p>Potentially, a relay through HPSS or Theia would work as well. Jet is used because it is generally the most reliable transfer method. From WCOSS, jetscp is frequently faster than Theia or HPSS because the dedicated network line between WCOSS and Theia/HPSS is often clogged. Transfers from WCOSS to Jet go through a different route.</p>
<h2>Critical NEMS Crontabs </h2>
<p>There are eight crontabs for NEMS: four for nemspara, and four for a personal account with git and website access. These can be found in the NEMS repository under <code>tests/nightly/cron/</code>. Note that all WCOSS cron jobs are launched from one part of WCOSS to all others via ssh. Presently, this is done from WCOSS Phase 1. It could be moved to any other part of WCOSS that has CRON.</p>
<p>The cron jobs fall under six categories. Example lines are shown in this list.</p>
<ol type="1">
<li>Create the directory for log files, otherwise the other commands cannot even start. Note that the personal account and role account will have different directories for the log file. We refer to both areas as <code>/path/to/log/dir</code> for brevity. <pre class="fragment">3 0 * * * mkdir -p /path/to/log/dir
</pre></li>
<li>Check out the repository for the nightly test. This is done only by the personal account. <pre class="fragment">00 16 * * * /path/to/NEMS/tests/nightly/run-from-wcoss.sh wcoss1  checkout &gt; /path/to/log/dir/checkout-wcoss-phase1.log 2&gt;&amp;1
</pre></li>
<li>Run the nightly test. Only nemspara runs this. <pre class="fragment">26 17 * * * /path/to/NEMS/tests/nightly/run-from-wcoss.sh wcoss1 test &gt; /path/to/log/dir/test-wcoss-phase1.log 2&gt;&amp;1
</pre></li>
<li>Transfer the website to a directory on Jet via jetscp. This is done only by nemspara. Note that it happens hourly. That is required because the tests may finish at any time. <pre class="fragment">47 * * * * /path/to/NEMS/tests/nightly/run-from-wcoss.sh wcoss1 deliver &gt; /path/to/log/dir/deliver-wcoss-phase1.log 2&gt;&amp;1
</pre></li>
<li>Transfer the website directory from Jet to the <code>dmzgw.ncep.noaa.gov</code> website back-end. This is done by the account that has access to the dmzgw. This may be an entirely different account than the two that maintain the test. <pre class="fragment"># Jet only!
13 * * * * rsync -arv /path/to/jet/web/dir/. username@dmzgw.ncep.noaa.gov:/home/www/emc/htdocs/projects/rt/. &gt; /path/to/log/dir/nightly-rt-web-transfer.log 2&gt;&amp;1
</pre></li>
<li>Send emails, if desired. Presently there are two cron jobs for these. One only sends an email if there are failures, and that email goes to all application code managers. The other always sends an email, even if nothing failed, and that goes only to the NEMS code manager. <pre class="fragment"># Only send failure emails:
5 6 * * * /path/to/NEMS/tests/nightly/email-rt.pl -e User.1@noaa.gov,User.2@noaa.gov,...  /path/to/jet/web/dir/*/*/*.txt &gt; /path/to/log/dir/nightly-rt-web-transfer.log/path/to/log/dir/nightly-test-email-selective.log

# Send all emails.  Note "-a" is now the first argument to the script:
5 18 * * * /path/to/NEMS/tests/nightly/email-rt.pl -a -e Use.1r@noaa.gov /path/to/jet/web/dir/*/*/*.txt &gt; /path/to/log/dir/nightly-rt-web-transfer.log/path/to/log/dir/nightly-test-email-selective.log
</pre></li>
</ol>
<h2>Generating the NEMS Documentation Webpage </h2>
<p>The NEMS documentation can be found here:</p>
<ul>
<li><a href="http://www.emc.ncep.noaa.gov/projects/nems-doc">http://www.emc.ncep.noaa.gov/projects/nems-doc</a></li>
</ul>
<p>It is generated from the contents of the <code>doc/</code> directory within the NEMS repository. This is the process for updating that documentation.</p>
<ol type="1">
<li>Get a copy of NEMS <pre class="fragment">git clone gerrit:NEMS
cd NEMS/doc
</pre></li>
<li>In the <code>Makefile</code> file, edit the "TARGET ?=" line for the current platform so it will transfer under your account. It should point to a test area, rather than the final one. <pre class="fragment">TARGET ?= samuel.trahan@dmzgw.ncep.noaa.gov:/home/www/emc/htdocs/projects/nems-sample/.
</pre></li>
<li>Make sure any local changes are committed and pushed to the origin. This is needed to ensure the hash at the top of the webpage and the documentation contents matches the repository copy: <pre class="fragment">git add ...
git rm ...
git commit ...
git push ...
</pre></li>
<li>Generate the webpage in the local directory: <pre class="fragment">make doc
</pre></li>
<li>Copy the webpage to the destination directory: <pre class="fragment">make deliver
</pre></li>
<li>Go to your web browser and make sure the webpage looks how you want it to. In the example path in step 2, that would be:</li>
</ol>
<blockquote class="doxtable">
<p><a href="http://www.emc.ncep.noaa.gov/projects/nems-sample">http://www.emc.ncep.noaa.gov/projects/nems-sample</a> </p>
</blockquote>
<ol type="1">
<li>If needed, edit the documentation and redo steps 2-6 until you like what you see.</li>
<li>Move the webpage to the final location: <pre class="fragment">ssh username@dmzgw.ncep.noaa.gov # or emcrzdm
cd /home/www/emc/htdocs/projects
rm -rf nems-doc
mv nems-sample nems-doc
</pre></li>
</ol>
<h2>Getting NEMS Access </h2>
<p>To run the NEMS multi-app regression tests, you need access to all VLAB and github repositories for all apps, NEMS, FMS, components, and NCEPLIBS-pyprodutil.</p>
<p>To have access to the "nems" project and "emc.nemspara":</p>
<ol type="1">
<li>Use the AIM webpage to get "nems" and "emc-nems" access. The "emc.nems" group is the equivalent of "nems" on HPSS.</li>
<li>The user's WCOSS account must be updated for "nems" and "emc.nemsparasudo" access. In EMC this is handled by Mary Hart.</li>
<li>Submit tickets to <a href="#" onclick="location.href='mai'+'lto:'+'rdh'+'pc'+'s.j'+'et'+'.he'+'lp'+'@no'+'aa'+'.go'+'v'; return false;">rdhpc<span style="display: none;">.nosp@m.</span>s.je<span style="display: none;">.nosp@m.</span>t.hel<span style="display: none;">.nosp@m.</span>p@no<span style="display: none;">.nosp@m.</span>aa.go<span style="display: none;">.nosp@m.</span>v</a>, <a href="#" onclick="location.href='mai'+'lto:'+'rdh'+'pc'+'s.t'+'he'+'ia.'+'he'+'lp@'+'no'+'aa.'+'go'+'v'; return false;">rdhpc<span style="display: none;">.nosp@m.</span>s.th<span style="display: none;">.nosp@m.</span>eia.h<span style="display: none;">.nosp@m.</span>elp@<span style="display: none;">.nosp@m.</span>noaa.<span style="display: none;">.nosp@m.</span>gov</a>, and <em>FIXME: what is the GAEA helpdesk?</em> asking for emc.nemspara sudo access.</li>
<li>Most likely, the "nems" group access will NOT be correctly propagated from AIM to GAEA, and possibly Jet or Theia. You will need to submit tickets for that.</li>
<li>In theory, you can get access to the "NEMS" group on the emc website by emailing the NCWCP helpdesk. In practice, tickets to that helpdesk are ignored. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
