<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NEMS: CDDM Workshop Report</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">master@7bd61225cb</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cddm-report.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CDDM Workshop Report </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section warning"><dt>Warning</dt><dd><b>This is document is retained for historical record; much information here is out-of-date.</b> This is the report from a workshop, as described below. The contents are copied verbatim. More recent information can be found in the <a class="el" href="documentation.html">Documentation</a> page.</dd></dl>
<dl class="section date"><dt>Date</dt><dd>CDDM workshop was held on September 1-2, 2016</dd></dl>
<p>&#160; </p><hr/>
<h1>Purpose </h1>
<dl class="section note"><dt>Note</dt><dd>This document requires a management decision about whether it will be maintained or its contents organized elsewhere. This is one of the actions identified in the CDDM workshop held on Sept. 1-2, 2016 (“Evaluation and dissemination plan for standards and policies”). It is understood that its content may be require changes.</dd></dl>
<p>This document is intended to describe the goals, nature, and strategy for code, data, and documentation management of NEMS modeling applications and suites.</p>
<h2>Overall Goals </h2>
<ul>
<li>Ensure that NCEP operational requirements are met.</li>
<li>Maintain all components used in NEMS-based suites as a set of community modeling applications that are part of a coordinated, unified modeling system.</li>
<li>Foster community involvement, experimentation, and model improvement to accelerate R2X.</li>
<li>Promote accessible, documented, robust, and portable code.</li>
</ul>
<h2>Stakeholders and Contributors </h2>
<ul>
<li>EMC modeling branch (Vijay Tallapragada)</li>
<li>NCO</li>
<li>ESMF and CoG team (Cecelia DeLuca, Gerhard Theurich)</li>
<li>Developmental Testbed Center (Ligia Bernardet, Laurie Carson)</li>
<li>HIWPP (Bonny Strong)</li>
<li>Developers from NOAA Laboratories (GSD, PSD, HRD)</li>
<li>CESM (Mariana Vertenstein)</li>
<li>COLA (Jim Kinter, Larry Marx)</li>
<li>VLab team (Ken Sperow)</li>
</ul>
<p>Others involved in NOAA model development are welcome to comment and contribute.</p>
<h2>Terminology and Background </h2>
<dl class="section note"><dt>Note</dt><dd>This section was reviewed and approved by Hendrik Tolman. It contains terminology that will need to be updated for conformance with the system architecture document glossary.</dd></dl>
<p>The NOAA Environmental Modeling System (NEMS) is infrastructure that underlies models used for predictions of the behavior of Earth's environment at a range of time scales. NEMS development is centered at the NOAA Environmental Modeling Center (EMC). Examples of other coupled modeling systems are the <a href="http://www2.cesm.ucar.edu/">Community Earth System Model (CESM)</a> and the <a href="http://www.metoffice.gov.uk/research/modelling-systems/unified-model">Met Office Unified Model</a>.</p>
<p>NEMS includes model coupling and utility infrastructure and is associated with a collection of model components representing major Earth system domains and processes. External model components have a primary development repository that is not at EMC. In general, model components are coupled through the NEMS mediator (in other modeling systems this is often called the "coupler").</p>
<p>NEMS can be assembled into a number of different modeling applications. Modeling applications are associated with a purpose, like medium-range forecasting; a set of model components; and a set of parameters that represent a range of supported options, including grids and resolutions. Different NEMS modeling applications can have different types and numbers of model components. Also, the same physical domain may be represented by different model components in different modeling applications. For example, in some NEMS modeling applications the ocean component may be HYCOM and in others it may be MOM5.</p>
<p>The Unified Global Coupled System (UGCS) is a set of NEMS applications that share model components and can operate across weather, sub-seasonal, and seasonal scales. UGCS-Seasonal is the first fully coupled application to be developed with NEMS.</p>
<p>NEMS is built using the <a href="http://www.earthsystemmodeling.org/">Earth System Modeling Framework (ESMF)</a> infrastructure software. ESMF provides utilities like generation of interpolation weights and time-related classes, and also wrappers that create a standard component calling interface. This enables model components developed at different sites to be coupled more easily.</p>
<p>The <a href="https://earthsystemcog.org/projects/nuopc/">National Unified Operational Prediction Capability (NUOPC)</a> Layer adds additional rules about how ESMF models interact in order to increase their technical interoperability. The NUOPC Layer addresses aspects such as the level of build dependencies, standardization of initialization phases, and standard names for exchange fields. NEMS is an example of a modeling system built using the NUOPC Layer architecture. In order to interface with the NUOPC Layer model component developers write wrappers or “caps” for the component. The caps contain translations of native data structures (e.g. grids, field data, time quantities), by reference or copy, into ESMF data structures.</p>
<p>The NEMS-based atmospheric models have two main elements: dynamic core and physical parameterizations. The Physics Interoperability Layer is a wrapper used to call the physical parameterizations. The physical parameterizations for the <a href="http://www.nws.noaa.gov/ost/nggps/">Next-Generation Global Prediction System (NGGPS)</a> will be contained in the Common Community Physics Package, a set of parameterizations modularized by physics type (radiation, microphysics, etc.).</p>
<p>A list of NEMS modeling applications is here:</p>
<ul>
<li><a href="https://vlab.ncep.noaa.gov/group/guest/welcome?p_p_id=101&amp;p_p_lifecycle=0&amp;p_p_state=maximized&amp;p_p_mode=view&amp;_101_struts_action=%2Fasset_publisher%2Fview_content&amp;_101_returnToFullPageURL=%2Fgroup%2Fguest%2Fwelcome&amp;_101_assetEntryId=2316208&amp;_101_type=content&amp;_101_groupId=95585&amp;_101_urlTitle=nems-applications&amp;_101_redirect=https%3A%2F%2Fvlab.ncep.noaa.gov%2Fgroup%2Fguest%2Fwelcome%3Fp_p_id%3D3%26p_p_lifecycle%3D0%26p_p_state%3Dmaximized%26p_p_mode%3Dview%26_3_groupId%3D0%26_3_keywords%3Dnems%2Bapplication%26_3_struts_action%3D%252Fsearch%252Fsearch%26_3_redirect%3D%252Fgroup%252Fguest%252Fwelcome&amp;inheritRedirect=true">VLAB NEMS Modeling Applications Page</a></li>
</ul>
<p>Workflow components refer to all packages that are used to to produce an end-to-end run, encompassing not only the modeling application itself, but also the broader category of software that implement functions such as pre-processing, data ingest, and post-processing. Each workflow component will include source code, configuration settings, and workflow controls for the component. For example, in the Hurricane Weather Research and Forecast (HWRF) suite, a workflow component is the Gridpoint Statistical Interpolation (GSI) data assimilation, which is executed in different configurations depending on storm characteristics, available datasets, etc.</p>
<p>A modeling suite is a collection of workflow components assembled for a particular purpose. Each operational modeling suite is such a collection. For example, the North American Mesoscale (NAM) suite includes a data assimilation workflow component, a NEMS modeling application, etc. The Short-Range Ensemble Forecast (SREF) suite includes a similar NEMS modeling application (the Non-Hydrostatic Multiscale Model on the B-grid, no ocean) but has additional workflow components for ensemble processing.</p>
<p>For illustration purposes, Table 1 shows a simplified list of workflow components for two existing suites, the NAM and the HWRF, along with a future suite (NGGPS Numerical Weather Prediction - NWP). The table shows that NEMS-based suites, such as NAM and NGGPS NWP, use several workflow components which are common to NEMS and/or non-NEMS suites. The following workflow components are highlighted in the table: GSI, WRF Preprocessing System (WPS), NEMS Preprocessing System (NPS), and Unified Post Processor (UPP).</p>
<h4>Table 1: Workflow components used in a suite (simplified)</h4>
<table class="doxtable">
<tr>
<th align="center">Suite </th><th align="center">GSI </th><th align="center">WPS </th><th align="center">NPS </th><th align="center">NEMS </th><th align="center">UPP  </th></tr>
<tr>
<td align="center">NAM </td><td align="center">YES </td><td align="center"></td><td align="center">YES </td><td align="center">YES </td><td align="center">YES </td></tr>
<tr>
<td align="center">NGGPS NWP </td><td align="center">YES </td><td align="center"></td><td align="center"></td><td align="center">YES </td><td align="center">YES </td></tr>
<tr>
<td align="center">HWRF </td><td align="center">YES </td><td align="center">YES </td><td align="center"></td><td align="center"></td><td align="center">YES </td></tr>
</table>
<h1>Modeling Applications and Suites </h1>
<h2>Parts of a NEMS-based Modeling Application </h2>
<ul>
<li>NEMS coupling software</li>
<li>NEMS model components for atmosphere, land, ocean, ice, ionosphere etc.</li>
<li>NEMS build system and configuration scripts</li>
<li>NUOPC caps for each component</li>
<li>Physics Interoperability Layer</li>
<li>Common Community Physics Package</li>
</ul>
<h2>Parts of a Modeling Suite </h2>
<ul>
<li>Modeling application(s)</li>
<li>Build system and makefiles for all workflow components</li>
<li>Pre-processors and data assimilation codes (NPS, GSI etc.)</li>
<li>Post-processors, product generators, verification, etc.</li>
<li>Running scripts, configuration files, suite automation files</li>
</ul>
<h1>Recent Changes at NCEP </h1>
<dl class="section note"><dt>Note</dt><dd>This section was reviewed and approved by Hendrik Tolman.</dd></dl>
<p>There are three ways in which new code development at NCEP is significantly different than what has come before. These changes have ramifications for repository and code management.</p>
<p>First, there is increasing emphasis on community modeling. Numerous model components developed external to NCEP through community-based approaches are being incorporated into NCEP operations. Further, the model components (such as WAVEWATCH III) and modeling applications that are developed at NCEP centers increasingly engage the broader community throughout the development process.</p>
<p>Second, there are many more model components in NCEP modeling applications than before, with more than eight types of types of separable model components (e.g. ocean) anticipated in NEMS, and multiple options for each type (e.g. MOM5, HYCOM, data and stub versions of the ocean component). This is a fundamental change that affects code management in a number of ways. Repository plans, testing and experimentation, and other aspects of code handling require special consideration. We include in the contributors to this document experts in the management, community support, and evaluation of many-component modeling applications.</p>
<p>Third, there is a desire to move to a unified modeling system that can operate more seamlessly across temporal and spatial scales. The common NEMS framework will be used to compose multiple modeling applications that can be used for different purposes. This means that where model components are common to modeling applications, and where workflow components are common to suites, changes need to be synchronized across the modeling applications and suites. For this reason, the repository and code management strategies for NEMS-based modeling applications and suites need to be considered holistically.</p>
<h1>Modes of Use and Implications </h1>
<p>The expectations about the modes of use for NEMS modeling applications and suites, including both operations and research, will inform choices about the repository and code management strategy.</p>
<h2>Operations </h2>
<p>EMC builds modeling applications to run within production suites. The goal is to create end-to-end systems that includes observational processing, data assimilation, model forecasts, post processing, verification, and assessment.</p>
<h2>Operational Workflows for Community Testing </h2>
<p>In order to support community engagement in the testing of modeling applications in operational suites, it is critical for the broader community to be able to run the production suites and evaluate changes according to skill and other prescribed metrics. This mode of community evaluation offers the most direct path from research to operations.</p>
<p>For the UGCS-Seasonal application, the expectation is that EMC will collaborate with the community on the design of a test harness, where EMC will make the control runs. Various partners and collaborators that are working on the upgrades to the physics, etc. will experiment with this basic version. All results will be posted to the EMC server. EMC will also work with the community on developing verification methods, such as a climate scorecard. As new components/upgrades take place, EMC will upgrade the repository trunk of the application accordingly.</p>
<h2>Model Development, Research, and Testing Workflows </h2>
<p>It will be useful from both a scientific and practical perspective for model developers and researchers to be able to run NEMS modeling applications and suites in ways that provide more flexibility than the operational workflows. For example, substantial research is needed to improve understanding of the interactions and feedbacks between system components. In addition, the option to configure and run a modeling suite in a research mode, which may differ from the operational modeling suites, is important for the transition of research capabilities to operational systems. Providing easy access to the NEMS mediator in an environment conducive to experimentation, such as NCAR’s CIME, will promote use of the ESMF/NUOPC interfaces and support research to operations across a broader community.</p>
<p>Intervening at the interface between component models makes it possible to control feedbacks between component models – a powerful paradigm for evaluating the role of those feedbacks – and it makes it possible to artificially alter the interactions among components to determine sensitivity and predictability. Similarly, alternative configurations such as the interactive ensemble (multiple simultaneous instantiations of one or more component models), super-parameterization (sub-cycled, sub-grid-scale representation of processes), and others, should be supported with the operational component models and the NEMS mediator.</p>
<p>To support such controlled experimentation, it is helpful if each model component can be run in a number of modes: fully prognostic mode, as a data model component that reads in observational or model generated data, or as a stub to satisfy interface requirements. This flexible design permits feedbacks between components to be selectively turned off, thereby enabling researchers to address a broad range of scientific questions and also to determine what aspects and components of the Earth system must be dynamic and fully coupled in order to satisfy operational forecasting requirements.</p>
<p>In order to be used in a community context, it is important to enable users to easily create custom configurations for their experiments, including running numerous out of the box experiments with various levels of model feedbacks enabled at a number of model resolutions and configurations.</p>
<p>Non-scientific (e.g. data, stub) versions of components can also be useful for introducing new components. The technical integration of existing prognostic components into the coupled system often happens in three stages. In the first stage, feedbacks are turned off and validation is carried out in a “stand-alone” configuration. In the second stage, a few selected feedbacks are turned on. In the final stage, full coupling with all prognostic components is implemented and evaluated. This sort of independent development of components followed by an integration stage may not always be ideal for scientific development of coupled systems, but it is an approach used frequently nonetheless.</p>
<p>For any complex software system, and especially for a coupled modeling system, automated system and unit tests to verify infrastructure functionality on a variety of machines and compilers are essential. These tests satisfy a number of high-level software requirements, such as the ability to give bit-for-bit identical answers after restarting from a checkpoint, providing answers independent of processor and/or OpenMP thread count, and ensuring that code refactorings do not change answers unless they are expected to do so. It is useful to be able to run the entire system test suite with a single command.</p>
<h1>Operating Principles </h1>
<dl class="section note"><dt>Note</dt><dd>Management review of this section is one of the items identified as an action in the CDDM workshop on Sept 1-2, 2016 (“Operating Principles”).</dd></dl>
<p>The following are a set of operating principles (OP later in the document) that apply across multiple categories of requirements.</p>
<ul>
<li>Make decisions with the end goal of producing the best possible forecasts, based on evidence rather than assertion.</li>
<li>Operate efficiently. Avoid redundancy, and favor automation over manual processes.</li>
<li>Promote transparency. To the extent possible, make code, data, documentation, requirements, policies, and plans openly available and clear.</li>
<li>Encourage community ownership and participation. Establish processes that enable partners to engage in decision-making.</li>
<li>Ensure that organizational structures support clear responsibilities and accountability.</li>
</ul>
<h1>Roles needed </h1>
<dl class="section note"><dt>Note</dt><dd>Completion and review of this section is one of the items identified as an action following the CDDM Sept. 1-2, 2016 workshop (“Organizational Description”).</dd></dl>
<ul>
<li><b>Component code managers</b> &mdash; These are people internal to EMC who are responsible for the technical aspects of the component code and its integration into the unified system.</li>
<li><b>External component points of contact</b> &mdash; These are people associated with external component development who can serve as a point of contact for coordination and synchronization with EMC.</li>
<li><b>Application leads</b> &mdash; People who are responsible for the scientific and technical development and delivery of a particular application.</li>
</ul>
<p>The current status at EMC is that there is a technical team with the following members:</p>
<ul>
<li>Mark Iredell: manager</li>
<li>Sam Trahan: NEMS code manager</li>
<li>Valbona Kunkel: Documentation</li>
<li>Hang Lei: Physics interface</li>
<li>Terry McGuinness: workflow</li>
<li>Kate Howard: scripts</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>It would be useful to describe the responsibilities of this team.</dd></dl>
<h2>Decision Making about Code, Data, and Documentation Processes and Policies </h2>
<dl class="section note"><dt>Note</dt><dd>Following the Sept 1-2, 2016 CDDM workshop, NCEP/EMC agreed to propose a process for reviewing software policies and processes. This has not been delivered.</dd></dl>
<p>What this might look like:</p>
<ol type="1">
<li>NCEP/EMC software lead decides whether or not the proposal merits review.</li>
<li>NCEP/EMC software lead and the proposer(s) decide on a team of reviewers.</li>
<li>One or more calls or meetings are scheduled to discuss and refine the proposal.</li>
<li>A decision is made following a clear protocol.</li>
<li>The proposal is included in a logical place in a developer guidance document, announced if appropriate, and posted to a development website.</li>
<li>Actions in the proposal are implemented.</li>
</ol>
<h1>Requirements Format and and Collection </h1>
<dl class="section note"><dt>Note</dt><dd>This section requires management review and concurrence. Currently, although EMC participated in formulating these guidelines, they are not following them. The convention should be modified or replaced with the format and procedures NCEP/EMC intends to follow for collecting and disseminating requirements.</dd></dl>
<p>Documented requirements and expectations, collected from appropriate stakeholders, serve as a foundation for formulating strategies and making decisions.</p>
<p>This document introduces a convention for requirements collection and presentation. Each entry includes:</p>
<ul>
<li><b>Id</b> &mdash; Requirement short identifier and number, e.g. SM1 (Software Management 1)</li>
<li><b>Type</b> &mdash; Current classifications include goal (general guidance or direction), expectation (exp; an assumption), requirement (req; a necessity), and recommendation (rec; a desire or suggestion).</li>
<li><b>Item</b> &mdash; Description of the entry.</li>
<li><b>Reason</b> &mdash; Rationale or motivation for the entry.</li>
<li><b>Source</b> &mdash; Person or group that originated the entry.</li>
<li><b>Status</b> &mdash; Implementation status or timeline associated with the entry.</li>
</ul>
<p>A simple requirements collection process typically involves identifying a scope, coordinator or moderator, a set of stakeholders, and assembling the requirements through a joint discussion. A new set of requirements can be expected to evolve and become a basis for action through ongoing vetting, periodic updates, and being referenced by those developing plans and products.</p>
<h2>Software Management </h2>
<h3>Goals, Requirements and Expectations</h3>
<dl class="section note"><dt>Note</dt><dd>This requirements section requires management review and concurrence.</dd></dl>
<p>In the chart below, OP stands for Operating Principles.</p>
<h3>SM1: Minimize Software Repositories Per Component</h3>
<p>Minimize the number of software repositories required per component. Best practices in software configuration management recommend using a shared common repository for development where feasible. New development can be managed using branches (or forks or equivalent) with the understanding of a common authoritative source (master/trunk) and a procedure for integrating new development into the source repository. This approach utilizes the strengths of configuration management tools, while minimizing the work and risk involved in maintaining duplicate repositories.</p>
<p><b>Type</b>: goal</p>
<p><b>Source</b>: GMTB</p>
<p><b>Status</b>: No policy in place</p>
<p><b>Reason</b>: OP, avoid duplication</p>
<h3>SM2: Source Code Available</h3>
<p>All source code for operational modeling applications and suites must be available on EMC computers. Availability in case there are problems.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: NCO</p>
<p><b>Status</b> Implemented</p>
<p><b>Reason</b> Availability in case of problems</p>
<h3>SM3: Accessible Repositories</h3>
<p>NEMS modeling applications and suites are expected to utilize multiple development repositories, including repositories managed externally and by EMC. It must be possible for developers (NOAA and non-NOAA) to access codes in the development repositories, workspaces, and trackers, with specific permission levels (read, read/write).</p>
<p><b>Type</b>: EXP</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: Not fully implemented, some key developers do not have access to workspaces and trackers.</p>
<p><b>Reason</b>: Access is needed for development.</p>
<h3>SM3a: Current Operational Code is Available</h3>
<p>It is essential that the currently operational code can be checked out. An exact mirror repository should be maintained that always has the latest operational code.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: COLA/Kinter</p>
<p><b>Status</b>: No policy in place</p>
<p><b>Reason</b>: This is needed to streamline the transition from research to operations</p>
<h3>SM4: EMC Repository Developer Responsibilities</h3>
<p>The following apply to developers working in an EMC repository:</p><ul>
<li>Developer maintains own branch of trunk.</li>
<li>Commit work back to branch from working copy frequently.</li>
<li>Keep up to date with trunk.</li>
<li>Use test harness for regression and suite testing prior to commits.</li>
<li>Use ticket system as required.</li>
</ul>
<p><b>Type</b>: EXP</p>
<p><b>Source</b>: EMC/Tollman</p>
<p><b>Status</b>: Unable to implement because of lack of access to computers and trackers..</p>
<p><b>Reason</b>: Follow good software practices for development.</p>
<h3>SM5: External Component Development Responsibilities</h3>
<p>The following apply to developers working with external components:</p>
<ul>
<li>If procedures used in the external, authoritative repository are compatible with NEMS development, the procedures specific to that component will be followed.</li>
<li>If the external, authoritative repository cannot support component development for NEMS, a development repository for EMC use will be established and the procedures established for EMC repositories followed.</li>
</ul>
<p><b>Status</b>: Implemented.</p>
<p><b>Reason</b>: Balance between low process overhead and control over processes.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<h3>SM6: Components have Identified Leaders</h3>
<p>There is an identified EMC component lead for all model and suite components. There is an external component lead identified for external components.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: NCO</p>
<p><b>Status</b>: Implemented</p>
<p><b>Reason</b>: OP, accountability.</p>
<h3>SM7: Identified Leaders for NEMS Documentation</h3>
<p>There are identified leads for the overall NEMS system development at EMC.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: Not implemented.</p>
<p><b>Reason</b>: OP, accountability.</p>
<h3>SM8: Synchronization Path to External Component Repositories</h3>
<p>Code changes to external components taking place in their native repositories must have a path for synchronization with changes made to these components at EMC, and vice versa. It is up to the EMC component lead to synchronize changes between development and operational repositories, in coordination with the external component lead. If necessary, users can download a tar file of a code release and return changes via tar file.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: EMC/Tollman</p>
<p><b>Status</b>: No controls in place.</p>
<p><b>Reason</b>: Need for synchronization of development to maintain coherence in community-based unified system.</p>
<h3>SM9: Synchronization Path of Component Code Between Applications</h3>
<p>Changes in components and infrastructure made for any given NEMS modeling application must have a process for synchronization with versions of these codes used by other NEMS applications.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: No policy in place..</p>
<p><b>Reason</b>: Need for synchronization of development to maintain coherence in community-based unified system.</p>
<h3>SM10: Standardized Testing and Implementation System</h3>
<p>There is standard regression, suite, operations testing for respectively software, science, and implementation.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: Key processes not implemented.</p>
<p><b>Reason</b>: Critical part of software process.</p>
<h3>SM11: Repository Strategy Supporting Many Components and Applications</h3>
<p>The repository strategy must support testing and experimentation with many-component modeling applications and suites.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: Repository strategy is not fully defined.</p>
<p><b>Reason</b>: Needed to manage development in multi-component, multi-application NEMS system.</p>
<h3>SM12: Component Versions Associated with Application Versions</h3>
<p>It must be possible to easily assemble a version of a particular modeling application, with versioned constituent components.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS</p>
<p><b>Status</b>: Implemented</p>
<p><b>Reason</b>: Needed to manage development in multi-component, multi-application NEMS system.</p>
<h3>SM13: Availability of Stub, Data, and Active Model Components</h3>
<p>Model components must offer active, stub, and data versions for testing and experimentation.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS, EMC/Grumbine</p>
<p><b>Status</b>: Data versions are not available.</p>
<p><b>Reason</b>: Needed for testing and development.</p>
<h1>Tools and Options: Collaboration Environments and Workflow Software </h1>
<h2>NWP Information Technology Environment (NITE) </h2>
<ul>
<li><a href="http://www.dtcenter.org/eval/NITE/">NWP Information Technology Environment (NITE)</a></li>
</ul>
<p>NITE is the collective name of various elements needed to support a computational infrastructure for simplified configuration and execution of experiments with NCEP modeling suites. These elements are: data management, code management, suite configuration, scripts, workflow management system, documentation/training, and database of experiment metadata. The Developmental Testbed Center (DTC) has created a <a href="http://www.dtcenter.org/eval/NITE/NITE-report-AOP2014.pdf">preliminary NITE design</a>, with a focus of making code, datasets, and running infrastructure easily available to NCEP and its external collaborators. EMC leadership has indicated that this design will be considered for building the NGGPS infrastructure. Since code management is one of the NITE elements, the recommendations contained in this document can be considered as an integral part of NITE.</p>
<h2>Virtual Lab (VLab) </h2>
<p>The VLab is a service and IT framework, enabling NOAA employees and their partners to share ideas, collaborate, engage in software development, and conduct applied research. The VLab is comprised of two main components:</p>
<ul>
<li>Virtual Lab Collaboration Services (VLCS)</li>
<li>Virtual Lab Development Services (VLDS)</li>
</ul>
<p>The VLCS is built upon a feature rich open source Java portal framework called Liferay. The VLCS enables users to share and contribute science and participate in dynamic virtual communities. The VLCS provides powerful tools for collaborating such as document libraries, wikis, message boards, blogs, announcements, dynamic forms with workflow, and a content management system (CMS). All tools within the VLCS are searchable and centralized. The VLCS provides a full featured administrative console and robust roles and permissions framework.</p>
<p>The VLDS provides web based services to help manage projects via issue tracking, source control sharing, code review, and continuous integration. Redmine is being used for issue tracking for all projects and access control for simple projects’ source code repositories within the VLab. Subversion and Git, a distributed configuration management (CM) system, are being used for source code control within the VLab and integrate with Redmine. Gerrit provides web based code review and project management tools to Git based projects in the VLab. Jenkins provides a web based continuous integration tool within the VLab. Projects can use Jenkins to automate the building of their code, execute unit tests, and perform custom checks anytime code is modified.</p>
<h2>Earth System CoG </h2>
<p>The Earth System CoG is an open, multi-agency collaboration environment that supports project hosting and linked project networks for software development and data dissemination. Project web pages are wikis that are easy to create and navigate. The environment is set up as a federation, so that federal centers and universities can install their own local CoG, but also access and link to projects across the full set of CoGs. CoG provides views of information across entire networks (for example, all people or all repository links). CoG also offers extensive data archival and search services through an integrated interface to the <a href="http://esgf.llnl.gov/">Earth System Grid Federation (ESGF)</a>, an international data distribution network. A large network of CoG site installations around the world is being used to support data dissemination of model output in support of the Intergovernmental Panel on Climate Change (IPCC) model intercomparison projects.</p>
<p>A CoG is installed at NOAA ESRL and is being used to host the <a href="http://cog-esgf.esrl.noaa.gov/projects/couplednems/">workspace for NEMS model coupling</a>, along with the <a href="https://www.earthsystemcog.org/projects/esmf/">ESMF site</a>, the <a href="http://www.earthsystemcog.org/projects/nuopc/">NUOPC Layer site</a>, and workspaces for individual NEMS-based applications such as the <a href="http://cog-esgf.esrl.noaa.gov/projects/wam_ipe/">WAM-IPE space weather coupling</a>. There is also a CoG at GFDL, and CoG installation is underway at NCEI.</p>
<dl class="section note"><dt>Note</dt><dd>Update link to WAM-IPE webpage when if it is moved to repo</dd></dl>
<h2>CIME </h2>
<p>The Common Infrastructure for Modeling the Earth (CIME) is a public, github based infrastructure repository initiated by the Community Earth System Model (CESM) software engineering group in April</p><ol type="1">
<li>CIME was developed as a response to the February 2</li>
</ol>
<h1>Tools and Options: Repository Software and Services </h1>
<p>In this section we describe options related to code access and developer access (which assumes write access) for infrastructure and scientific software and documentation.</p>
<h2>Repository Software: Git and Subversion </h2>
<p><a href="https://git-scm.com/">Git</a> and <a href="https://subversion.apache.org/">Subversion (SVN)</a> are both widely used version control software packages. There are several advantages to using Git relative to Subversion and other version control software. Git is faster, was designed to to be fully distributed from the start, and provides a forking service which simplifies the process for developers to submit development work back to a master repository. In addition, the following advantages of Git are listed at:</p>
<ul>
<li><a href="https://git.wiki.kernel.org/index.php/GitSvnComparison">https://git.wiki.kernel.org/index.php/GitSvnComparison</a></li>
</ul>
<p>Several teams that support multi-component systems, including CESM, mix Git and Subversion in order to get desirable properties from each. Using both can also be a viable implementation strategy for non-disruptive transitions from use of Subversion to full use of Git. Such an approach is described in the Current Practice and Recommended Evolution section.</p>
<h2>Repository Software Service: Github, VLab, or elsewhere (such as NCAR or EMC servers) </h2>
<p>Having the source code accessible is very important for EMC to meet its mission of fostering community involvement for NWP development. Therefore it needs to be straightforward for community members to obtain access to the code repositories that house the components of NEMS-based modeling applications and suites.</p>
<p>Most EMC NWP codes currently reside in SVN repositories accessible through EMC servers. Access to those servers is very restricted to non-NOAA developers. One exception is HWRF, whose code resides at NCAR and GSD and is managed by DTC. To alleviate access restrictions to the general community, DTC has also mirrored some parts of the EMC SVN repositories at NCAR (for example, NEMS and GSI). However, the mirrors are labor intensive, prone to error, and many times insufficient (when not all branches are mirrored).</p>
<p>In contrast, access to code repositories served through GitHub is straightforward. Access to VLab is likely to be easy as well. Therefore, those alternatives are expected to foster a more robust collaborative environment at lower cost.</p>
<p>In addition to repository access, both GitHub and VLab have several tools that greatly facilitate collaborative software development. Github provides both wikis and issue tracking that can be utilized to track both repository specific issues or general issues for the whole project. Github provides tools for inspecting the history and structure of the repository. It has excellent documentation that permits both novice users and experts to make the optimal use of git, and provides an organizational structure that allows for both public and private repositories on a very cost effective basis. Finally, GitHub has both excellent uptime and customer support. Repository Access and Use Procedures</p>
<table class="doxtable">
<tr>
<th>&#160;</th><th>EMC</th><th>CIME</th><th>VLab </th></tr>
<tr>
<th>Contents</th><td>Science components, coupling infrastructure, workflow infrastructure </td><td>Infrastructure only; currently CESM and ACME coupling and workflow infrastructure and non-scientific versions of model components </td><td>Any NOAA R&amp;D project repositories  </td></tr>
<tr>
<th>Version control software protocol </th><td>Subversion </td><td>Git </td><td>Git or Subversion  </td></tr>
<tr>
<th>Version control software service </th><td>EMC server </td><td>Github </td><td>Subversion and Git over https or Git through Gerrit  </td></tr>
<tr>
<th>Public download? </th><td>Not for development code. </td><td>Development and release versions can be downloaded by anyone from <a href="https://github.com/CESM-Development/cime">https://github.com/CESM-Development/cime</a>. </td><td>Not currently. Must have a NOAA LDAP login or VLab external partner login.  </td></tr>
<tr>
<th>Information collected from users? </th><td>NOAA computer access requires submission of fingerprints and detailed personal history for a Federal background investigation. </td><td>No information is collected other than that required for a Github account. </td><td>None required for NOAA accounts. NOAA External partner sponsors must supply basic contact information of external partner (e.g., phone, email, name, and justification).  </td></tr>
<tr>
<th>Download metrics available? </th><td>Not easily </td><td>Github tracks downloads/clones, and this is available to project administrators </td><td>Some usage statistics are available through Google Analytics  </td></tr>
<tr>
<th>Typical length of time required for read access? </th><td>2-6 months </td><td>Immediate </td><td>Same or next day  </td></tr>
<tr>
<th>Typical length of time required for write access? </th><td>At least 6 months </td><td>Less than a day to days </td><td>Same or next day   </td></tr>
</table>
<h2>Procedure for Developer Access </h2>
<h3>CIME</h3>
<p>To write to CIME a user issues a pull request on github. This is documented at</p>
<ul>
<li><a href="https://github.com/CESM-Development/cime/wiki/CIME-Development-Guide">https://github.com/CESM-Development/cime/wiki/CIME-Development-Guide</a></li>
</ul>
<p>Anyone can issue a pull request, regardless of if they are inside or outside of NOAA. Currently, the gatekeepers for determining whether or not to accept a pull request are members of the CESM Software Engineering Group (or CSEG). However, this governance structure can be extended depending on the collaboration. As an example, CESM and the DOE/ACME project have created a new github repository, <a href="https://github.com/ESMCI/cime">https://github.com/ESMCI/cime</a> that currently mirrors CIME, but where the determination of what pull requests to accept are made jointly by both CSEG and ACME software engineers. A similar CIME repository structure can also be established with NOAA or the CIME administration structure can be easily enhanced using github's administration and organizational tools.</p>
<p>CSEG has established a workflow for using and developing CIME. This can be found at</p>
<ul>
<li><a href="https://github.com/CESM-Development/cime/wiki/CIME-Git-Workflow">https://github.com/CESM-Development/cime/wiki/CIME-Git-Workflow</a></li>
</ul>
<p>Further documentation for dealing with the externals in CIME can also be found at</p>
<ul>
<li><a href="https://github.com/CESM-Development/cime/wiki/Managing-externals-included-in-CIME">https://github.com/CESM-Development/cime/wiki/Managing-externals-included-in-CIME</a>.</li>
</ul>
<p>CIME is just in its infancy and as it continues to expand in the number of collaborators that are interested in using and contributing to it, a more formal governance structure will need to be established.</p>
<h3>VLab</h3>
<p>Any user with a NOAA LDAP ID has access to the VLab. If the user does not have a NOAA LDAP ID a NOAA user can request a VLab account for external partners (e.g., other government agencies, University Partners) through VLab forms. Project owners add users as a member of their project within VLab’s Redmine web interface to give users access to the underlying repository. See the <a href="https://vlab.ncep.noaa.gov/redmine/projects/vlab/wiki/Help_for_Project_OwnersManagers#Adding-Members-to-a-Project">VLab Wiki guidance</a> for more information.</p>
<h3>EMC Repository</h3>
<p>Access to NOAA computers requires the following steps:</p>
<ul>
<li>Obtain and utilize a NOAA email address to communicate regarding NOAA issues. This requires several steps (allow 2-4 weeks of processing time).</li>
<li>Complete NOAA’s annual IT Security Awareness Course ( ITSAC) (1 hour of security training). Repeated annually.</li>
<li>Complete a National Agency Check and Inquiries (NACI) background check. This includes fingerprinting and providing a detailed personal history (allow minimum of 6 months).</li>
<li>Computer account application (allow a minimum of 2-4 weeks of processing time).</li>
<li>Request access to the NEMS repository and group permissions (allow 1-2 weeks of processing time).</li>
<li>Users must login every 30 days to keep their proxy certificate up to date or their account will be disabled.</li>
<li>Verify account information on an annual basis.</li>
</ul>
<p>There is a slightly faster path: acquiring checkout approval for the EMC NEMS SVN repository takes on the order of a month or two, and the code can be checked out onto a widely accessible computer at NCAR (yellowstone). In practice, this solution often requires people to move files across machines in order to collaborate, and is error-prone.</p>
<h1>Software Management Current Practice and Recommended Evolution </h1>
<dl class="section note"><dt>Note</dt><dd>This section requires management review and concurrence. The assembly of a plan for repository management is one of the items identified as an action in the CDDM workshop on Sept. 1-2, 2016 (“Repository reference document”). There is also a technical action associated with this section (“Web-based interface for account requests”). NEMS Repository</dd></dl>
<p>NEMS modeling applications are becoming more complex due to the fact that they are now multi-component applications. The matrix view, with components along the horizontal, and applications along the vertical, is a useful visualization of this. It can be seen in the <a href="https://vlab.ncep.noaa.gov/group/guest/welcome?p_p_id=101&amp;p_p_lifecycle=0&amp;p_p_state=maximized&amp;p_p_mode=view&amp;_101_struts_action=%2Fasset_publisher%2Fview_content&amp;_101_returnToFullPageURL=%2Fgroup%2Fguest%2Fwelcome&amp;_101_assetEntryId=2316208&amp;_101_type=content&amp;_101_groupId=95585&amp;_101_urlTitle=nems-applications&amp;_101_redirect=https%3A%2F%2Fvlab.ncep.noaa.gov%2Fgroup%2Fguest%2Fwelcome%3Fp_p_id%3D3%26p_p_lifecycle%3D0%26p_p_state%3Dmaximized%26p_p_mode%3Dview%26_3_groupId%3D0%26_3_keywords%3Dnems%2Bapplication%26_3_struts_action%3D%252Fsearch%252Fsearch%26_3_redirect%3D%252Fgroup%252Fguest%252Fwelcome&amp;inheritRedirect=true">NEMS application list</a> and in also in the matrix of workflow components shown in the Terminology and Background section of this document. These matrices show that the same components are going to be used in several modeling applications. In other words, there are complex software interactions going many different ways within the matrices. The desire for a unified system recognizes the advantage of not treating each application line in the matrices as separate from the other. This is also reflected in the software management requirements and expectations. The following approach carries this awareness through to the construction of the revision control architecture.</p>
<p>In the proposed revision control architecture, the applications, the components, and the NEMS infrastructure itself are top level directories under the EMC /projects repository. EMC refers to each of these directories as a project. The connection to the matrix representation is made by introducing SVN externals (here just called links). The proposal is to recognize the components as the primary sorting axis, and to introduce an SVN external link to a specific revision of each component from each application. The application group still has full control over the component sources, but there is this recognition that the components are the building blocks. Figure 1 shows a UGCS-Seasonal revision defined as a set of links to specific revisions of NEMS (which currently includes GSM), MOM5, and CICE.</p>
<p>Building a complex system that supports many components and many applications is not something that happens without a lot of effort. It's like a family, each member needs to grow individually, and they need the freedom to do so, but if you want to still be recognizable as a family, there are times for each member to put effort into something that maybe is not directly their interest. Same here: if the vision of a unified modeling system is going to be realized, there must be times when changes to common pieces are reconciled again. The more convenient and obvious we can make this within the revision control architecture, the better. Requirement SM6, which requires a liaison internal to EMC for each component, and a liaison external to EMC for each component, begins to create a structure for coordination.</p>
<p>It should also be realized that we are trying to set up an evolutionary rapid development process. This is in many ways a new approach for EMC, but really the only way that applications can be delivered in time, while moving toward a unified modeling system. It's probably fair to say that the era in which you could wait for a "working system" for a specific application, and then go and modify it for the operational need, is over. Instead the system as a whole must be evolvable, ready to react, and to do this systematically and responsively. On the source level, SVN with the proposed repo architecture can serve as the necessary backbone for this development style.</p>
<div class="image">
<img src="repo-structure.png" alt="repo-structure.png"/>
<div class="caption">
Figure 1. Project Directory Structure for NEMS Components and Applications</div></div>
<p> Proposed directory structure for the CFS version 3 project.</p>
<h2>Component Sets (Compsets) </h2>
<p>The concept of "component sets", or "compsets" for short, has been used successfully by the [<a href="http://www2.cesm.ucar.edu/">http://www2.cesm.ucar.edu/</a>] (CESM) project for some time to <a href="http://www.cesm.ucar.edu/models/cesm1.2/cesm/doc/modelnl/compsets.html">systematically label different run configurations</a>. The labels are associated with scripts that pull together all the files and inputs needed to run the specified configurations. This approach offers a number of benefits:</p>
<ul>
<li>standard runs can be set up easily and consistently</li>
<li>it is a very effective way to implement regression testing across a system with many possible combinations of components</li>
<li>it is a systematic way of managing the complexity associated with not just many components, but multiple (data, stub) non-prognostic versions of components, and facilitates controlled experimentation</li>
</ul>
<p>Compsets are currently being used only for technical testing in NEMS, but could also be applied to scientific model configuration and validation. More information about compsets is in the <a class="el" href="documentation.html">NEMS Users Guide</a>.</p>
<h2>Guidelines for Software Checkins and Updates </h2>
<p>The instructions in this section use the following terms to refer to the parts of an URL pointing to a software package “ABC” that is under SVN revision control:</p>
<p><b>Complete URL:</b></p>
<ul>
<li><a href="https://server.noaa.gov/path/ABC/subdir">https://server.noaa.gov/path/ABC/subdir</a></li>
</ul>
<p>This is the complete URL that can be used in a SVN checkout command to obtain an instance of the full source code structure of the ABC software.</p>
<p><b>Base URL:</b></p>
<ul>
<li><a href="https://server.noaa.gov/path/ABC">https://server.noaa.gov/path/ABC</a></li>
</ul>
<p>This is base URL of the ABC software. Following SVN conventions there should be exactly three canonical subdirs under the base URL: trunk, branches, tags. However, this is only a convention and there is no enforcement mechanism.</p>
<p><b>Trunk URL:</b></p>
<ul>
<li><a href="https://server.noaa.gov/path/ABC/trunk">https://server.noaa.gov/path/ABC/trunk</a></li>
</ul>
<p>This is the complete URL that points to the trunk of the ABC software (following SVN convention).</p>
<p><b>Branch URL:</b></p>
<ul>
<li><a href="https://server.noaa.gov/path/ABC/branches/name">https://server.noaa.gov/path/ABC/branches/name</a></li>
</ul>
<p>This is the complete URL that points to the <code>name</code> branch of the ABC software (following SVN convention).</p>
<p>In order to build, run, and modify a NEMS application the first step is to check out from the appropriate "complete URL". Depending on the circumstances, this may be a "trunk URL" or a "branch URL". Also, you may currently run into a variety of "base URL" options. Assuming that NEMS application ABC was set up according to the conventions outlined in the previous section, the "trunk URL" will look like this:</p>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/ABC/trunk">https://svnemc.ncep.noaa.gov/projects/ABC/trunk</a></li>
</ul>
<p>However, currently no applications exist YET directly under the /projects level, instead most applications are located under the NEMS project at /projects/nems/apps. This directory was introduced as a temporary staging area for NEMS application. For example the "trunk
URL" of the current UGCS-Seasonal application is</p>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Seasonal/trunk">https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Seasonal/trunk</a></li>
</ul>
<p>It has been the plan for a while to move away from the NEMS project in the short term for the staging area. Instead a more generic location, e.g. /projects/nems-X/apps, should be created. However, this transition has not yet happened. In the long run, sanctified NEMS applications should end up with a "base URL" directly under /projects.</p>
<p>A few remarks:</p>
<ul>
<li>The following instructions apply no matter what the current "base URL" of the NEMS application looks like.</li>
<li>It is assumed that the application liaison has provided you with the appropriate "complete URL" for the work you are planning to perform. This may be a "trunk URL", or a "branch URL". Either way, the following instructions apply.</li>
<li>In order to keep the instructions general the string <code>(complete-URL)</code> is used to stand for the complete URL you were told to use.<ul>
<li>The string ABC is used to stand for the name of the application.</li>
<li>The string REV is used to stand for a specific SVN revision number.</li>
</ul>
</li>
</ul>
<p>Checking out and building a specific version of the application code </p><pre class="fragment">svn co -r REV (complete-URL) ABC
cd ABC
./NEMS/NEMSAppBuilder
</pre><p>This will check out the source code into directory ABC, and build the application. It is up to the application liaison to ensure that the complete URL provided is appropriate. In most cases this means that it is strictly versioned, i.e. each of the constituent components pulled in via SVN externals are referenced with specific revision numbers. This typically also means that you received a revision number REV together with the complete URL.</p>
<p>It the case of the UGCS-Seasonal application, step 1. above will currently check out a directory structure similar to this:</p>
<ul>
<li>UGCS-Seasonal<ul>
<li>NEMS &ndash;(svn:externals)&ndash;&gt; rev on EMC subversion trunk</li>
<li>GSM &ndash;(svn:externals)&ndash;&gt; rev on EMC subversion trunk</li>
<li>NMM &ndash;(svn:externals)&ndash;&gt; rev on EMC subversion trunk</li>
<li>CICE &ndash;(svn:externals)&ndash;&gt; rev on GitHub</li>
<li>CICE_CAP &ndash;(svn:externals)&ndash;&gt; rev on GitHub</li>
<li>MOM5 &ndash;(svn:externals)&ndash;&gt; rev on GitHub</li>
<li>MOM5_CAP &ndash;(svn:externals)&ndash;&gt; rev on GitHub</li>
</ul>
</li>
</ul>
<p>Note that if you checked out with a specific revision REV, it is generally unsafe to do an <code>svn update</code> from with the UGCS-Seasonal directory. The update will move the code to the current head of the checked out complete URL. This also means it will update the SVN external links to whatever revision the head version is pointing to.</p>
<h3>Checking out, modifying, committing application code</h3>
<p>While it is important to stay with the specific revision of the application code (including the constituent components) when validating specific version of the software, a head version is required when doing development work. The reason is that code modifications can only be committed back to the head, not to a specific revision.</p>
<p>There are two scenarios to cover: 1) the current application head is not strictly versioned, or 2) the current application head is strictly versioned.</p>
<ol type="1">
<li><p class="startli">The convention for the UGCS-Seasonal application is to not strictly version the head of the application trunk during development phases. This means that under most circumstances if you update to the head of the trunk URL of UGCS-Seasonal, all of the SVN externals will be pointing to the constituent's head, without specific revision number. This allows development on the head for each component. When ready, and tested, code changes can easily be committed by <code>svn commit</code> from within each affected constituent component subdir. It is also safe to execute <code>svn update</code> from within constituent subdirectories.</p>
<p class="startli">Only snapshot revisions of the UGCS-Seasonal trunk are strictly versioned, however, they are followed immediately by a commit that removes strict versioning again from the head. This allows us to provide strictly versioned revisions, while keeping the development process simple.</p>
</li>
<li><p class="startli">Applications where the head revision is strictly versioned require more attention when modifying code and commit code changes. Executing “svn update” directly under a strictly versioned application head will always bring the constituent components back to the revision specified by the SVN externals!</p>
<p class="startli">The constituent components can still be moved (individually) to their head revision by changing into the respective subdirectly and executing <code>svn update</code> from within. This then allows local code modifications to be committed. However, an update on the application level will revert the subdirectory back to the fixed revision according to the SVN external definition. This can be very confusing.</p>
</li>
</ol>
<h3>Proposed Processes for Coordinating Software Across NEMS</h3>
<p>Link to proposal for code, documentation, and script changes from Sam Trahan.</p>
<p>It is assumed that external components that do not support EMC or community access have a local, mirrored repository at EMC.</p>
<p>A proposed central rule is that before (or after) a major release or delivery, an application should merge its changes back to all constituent component project repositories at EMC, including NEMS itself. This is understood to be a minimum; it may be more frequent. Additionally, after a release or delivery, a strongly versioned tag should be created that includes specific revisions for all constituent components.</p>
<p>All components have EMC points of contact and native points of contact. The points of contact should define rules for creating branches for their component. They should also work out a plan and process for migrating changes back to the native component repository, if it is outside of EMC.</p>
<p>Questions about process for each component should be directed to both the EMC point of contact and the native point of contact.</p>
<h1>Coding standards </h1>
<dl class="section note"><dt>Note</dt><dd>The proposed standards here need to be reconciled with Environmental Equivalence 2. The section should be updated to reflect the standards that NCEP/EMC intends to follow.</dd></dl>
<p>The following table specifies coding requirements and recommendations for a parameterization to be included in CCPP. The intent is to promote readability, robustness, and portability without being too onerous. The Kalnay rules and work by the NUOPC Physics Interoperability Team and EMC personnel had a major impact in creating this list. The GSM coding standards described at</p>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/trac/gsm/wiki/GSM%20code%20standards">https://svnemc.ncep.noaa.gov/trac/gsm/wiki/GSM%20code%20standards</a></li>
</ul>
<p>were taken into account and incorporated as applicable. Unless specified otherwise, the Fortran programming language is assumed.</p>
<dl class="section note"><dt>Note</dt><dd>Move the GSM coding standards to a public area</dd></dl>
<h3>CS1: Fortran Implicit None</h3>
<p>All fortran modules and subroutines will contain <code>implicit none</code></p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, GSM</p>
<p><b>Reason</b>:</p>
<ul>
<li>Assists in writing bug-free code.</li>
<li>Understanding implicit type rules is difficult and arcane.</li>
<li>Understanding where a variable comes from (local, input argument list, module) is more difficult with implicit typing</li>
</ul>
<h3>CS2: Fortran <code>Intent</code> Attribute</h3>
<p>All arguments to subprograms will contain the <code>intent</code> attribute</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>:</p>
<ul>
<li>Assists readers in understanding whether a variable is:<ul>
<li>read-only: intent(in)</li>
<li>read/write: intent(inout)</li>
<li>effectively uninitialized: intent(out)</li>
</ul>
</li>
<li>A compiler error will result if code attempts to use a variable differently than specified in its <code>intent</code>.</li>
<li>Declared variables without the <code>intent</code> attribute can be understood to be local.</li>
</ul>
<h3>CS3: Fortran 2008 Standard Compliance</h3>
<p>No modules or subroutines will violate the Fortran 2008 standard</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB</p>
<p><b>Status</b>: Undetermined</p>
<p><b>Reason</b>:</p>
<ul>
<li>Makes porting to a new compiler easier to near trivial.</li>
<li>Example: gfortran by default enforces the standard that free-form source lines will not exceed 132 characters. Some compilers by default allow line lengths to exceed this value. Attempts to port codes with line lengths greater than 132 may encounter difficulty.</li>
</ul>
<h3>CS4: Inline Documentation of Variables</h3>
<p>All local and argument list variables will have a comment explaining the meaning of the variable. An in-line comment on the declaration line is sufficient</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Status</b>: Undetermined</p>
<p><b>Reason</b> Allows readers unfamiliar with the code to more quickly understand how the code works.</p>
<h3>CS5: Documenting Fortran Subprograms and Modules</h3>
<p>All modules and subprograms will have a documentation block describing functionality</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: Promotes understanding of algorithms and code structure by new users</p>
<h3>CS6: No Fortran Common Blocks</h3>
<p>Common blocks are disallowed</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: Deprecated Fortran feature. Modules provide all the functionality of common blocks plus much more.</p>
<h3>CS7: Compatible with GNU gfortran</h3>
<p>A package must be compilable with the gfortran compiler (or gcc for packages coded in C). Runnability and validation can be provided using whatever compiler(s) the developer prefers.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: gfortran (and gcc) is free and ubiquitous, and therefore is an ideal choice for canonical compiler.</p>
<h3>CS8: Free-Form Fortran</h3>
<p>All Fortran source will be free-form</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>:</p>
<ul>
<li>Fixed-form source is hard to read and archaic.</li>
<li>A 72-column requirement only makes sense for punch cards.</li>
</ul>
<p>CS9: Fortran-Callable</p>
<p>All public subprograms will be Fortran-callable</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: Fortran is the most commonly used language for geophysical models.</p>
<h3>CS10: Thread-Safe Parameterizations</h3>
<p>All parameterizations must be thread-safe (except for initialization and finalization methods)</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>:</p>
<p>Many geophysical numerical models are threaded these days, and need to be able to invoke physical parameterizations simultaneously from multiple threads.</p>
<p>Example code which is NOT thread-safe: Declare a variable <code>first</code> and initialize it to .true. Then test its value and set some static variables if it is .true. This will likely result in wrong answers when run in threaded mode.</p>
<p>Solution: Provide an initialization routine which sets the static variables outside of threaded regions.</p>
<p>Wikipedia provides a brief overview of thread-safety:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Thread_safety">https://en.wikipedia.org/wiki/Thread_safety</a></li>
</ul>
<h3>CS11: No parameterization will contain a <code>stop</code> or <code>abort</code> clause</h3>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: If an error condition arises, it is better to set a flag and let the caller decide how to handle the condition.</p>
<p><b>Status</b>: Not yet implemented.</p>
<h3>CS12: Use of uninitialized variables is disallowed</h3>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, GSM</p>
<p><b>Reason</b>: Readability.</p>
<p>Not all compilers can be made to initialize static or stack variables to a known value (e.g. zero).</p>
<h3>CS13: All array indices must fall within their declared bounds.</h3>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: Debuggers will fail when "tricks" are employed which reference arrays outside of their declared bounds.</p>
<h3>CS 14: Self-Reproducible Parameterizations</h3>
<p>Multiple runs of the same compiled parameterization given identical input must produce identical output. In the case where randomness is part of the parameterization, a method must be provided to invoke the same random sequence for test reproducibility.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, NUOPC PI Team, GSM</p>
<p><b>Reason</b>: Prevents inadvertent errors.</p>
<h3>CS15: Do Not Set Fortran Default Precisions</h3>
<p>The use of compiler flags specifying default precision is disallowed. For example, if 64-bit precision is required, use the <code>kind=</code> attribute to specify the precision rather than a compiler flag such as <code>-r8</code> </p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: The behavior of flags is compiler-specific, e.g. if the user specifies <code>real*4</code> does the <code>-r8</code> compiler flag</p>
<h3>CS16: List Public Entries in Fortran <code>module use</code> Statements</h3>
<p>With the exception of common libraries which use a well-defined naming standard for variables and subroutines, all <code>module use</code> statements must explicitly state which public entities will be referenced. The MPI library is an example of an acceptable exception: All MPI routines start with <code>MPI</code>, so a blank <code>use mpi</code> statement is acceptable.</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: Assists in understanding where various variables and/or functions or subroutines are defined.</p>
<h3>CS17: No Debugging Code</h3>
<p>All code intended for debugging purposes only should be removed prior to submission for inclusion</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB, GSM</p>
<p><b>Reason</b>: Readability</p>
<h3>CS18: Deallocate Allocated Arrays</h3>
<p>All arrays explicitly allocated, must be deallocated when no longer needed</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: GMTB, GSM</p>
<p><b>Reason</b>: Readability. Minimize memory usage.</p>
<h3>CS19: Default Visibility is <code>private</code></h3>
<p>The default visibility rule for module variables and procedures should be <code>private</code> (specified by a single <code>private</code> statement near the beginning of the module). The <code>public</code> attribute is applied to only those entities which are needed by other subprograms or modules.</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: Limiting variable and subprogram scope is good programming practice</p>
<h3>CS20: Consistent Case in Fortran Code</h3>
<p>Consistent use of case is preferred for Fortran code (text strings excepted).</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: While Fortran is a case-insensitive language, variable <code>aBc</code> should also be expressed that way, and not <code>aBc</code> in one place, <code>abc</code> in another, and <code>ABC</code> in another.</p>
<h3>CS21: Parameterization Steps</h3>
<p>A parameterization should contain <code>init</code>, <code>run</code>, and <code>finalize</code> methods. The <code>run</code> method must be thread-safe.</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: Promotes separation of activities which must be done only once at startup or shutdown, from those which are done on multiple time steps.</p>
<h3>CS22: Parameterizations Invoked in Chunks</h3>
<p>Parameterizations should be able to be invoked in "chunks", where the calculations are independent of the fastest-varying subscript.</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>:</p>
<p>Computational performance is the main reason for this preference. Many physical parameterizations in geophysical models contain a dependence in the vertical, which means this dimension is unavailable for vectorization. Vectorization can provide up to a 16X speedup on modern processors.</p>
<p>Example: Outer loop over vertical index <code>k</code> can contain vertical dependence, but if there is also an inner loop over horizontal index <code>i</code> that can be vectorized, the code is likely to run much more efficiently.</p>
<h3>CS23: Don't <code>GOTO</code></h3>
<p>The use of <code>GOTO</code> is strongly discouraged, except where no better option is available.</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b> Modern languages provide better mechanisms to accomplish the same goal in most cases. <code>GOTO</code> promotes "spaghetti" code, which can be unreadable.</p>
<h3>CS24: Nested Scope Indentation</h3>
<p>Code and declarations within subprograms, loops, and conditional tests should be indented. Indenting by 2 or 3 or 4 columns is reasonable</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>: Readability. Particularly important for multiply nested loops and/or <code>if</code> tests.</p>
<h3>CS25: Use Symbolic Fortran Comparison Operators</h3>
<p>Test operators <code>\&lt;</code>, <code>\&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>/=</code> are preferred vs. their deprecated counterparts <code>.lt.</code>, <code>.le.</code>, <code>.gt.</code>, <code>.ge.</code>, <code>.eq.</code>, <code>.ne.</code></p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB, GSM</p>
<p><b>Reason</b> The modern constructs are easier to read, and more understandable for those unfamiliar with legacy code.</p>
<h3>CS26: No Bare Constants</h3>
<p>The use of bare constants (e.g. <code>2.7</code>) inside of computational regions is strongly discouraged. Instead, a named constant (e.g. <code>some_variable = 2.7</code>) should be declared at the top of the routine or module, along with an in-line comment stating its purpose</p>
<p><b>Type</b>: Recommended</p>
<p><b>Source</b>: GMTB</p>
<p><b>Reason</b>:</p>
<p>Bare constants buried in code is one of the biggest contributors to lack of readability and understanding of how code works. "What the
heck does `2.7` mean???" In addition, using a named constant makes it easier to specify precision, e.g. <code>real*8 some_var = 35.</code></p>
<h1>Documentation Management </h1>
<h2>Goals, Requirements and Expectations </h2>
<p>In the chart below, OP stands for Operating Principles.</p>
<h3>D1: Well-Maintained Documentation</h3>
<p>Maintain comprehensive, accessible, and up-to-date documentation for users, developers, managers, and other stakeholders.</p>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: Documentation is necessary to operate NEMS.</p>
<p><b>Status</b>: Completed initial survey.</p>
<h3>D2: Avoid Duplication of Documentation</h3>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, avoid duplication.</p>
<p><b>Status</b>: No checks in place.</p>
<h3>D3: Documentation Delivered with Software</h3>
<p>Documentation should be generated at the time of development and is considered part of any software delivery.</p>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Status</b>: No checks in place.</p>
<p><b>Reason</b>: Encourages timely and accurate documentation.</p>
<h3>D4: Example Code should be in Regression Tests</h3>
<p>Any code snippets or code examples in the documentation should be linked via documentation generation tools to actual code that is included in regular regression testing.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: Minimize the maintenance burden.</p>
<p><b>Status</b>: Some implementation, no checks in place.</p>
<h3>D5: Public Visibility of Documentation</h3>
<p>Documentation that does not present a security concern should be publicly visible.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, open for viewing.</p>
<p><b>Status</b>: No general agreement.</p>
<h3>D6: Documentation is Accessible</h3>
<p>Documentation should be accessible to collaborators for contributions.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, open for participation.</p>
<p><b>Status</b>: No general agreement.</p>
<h3>D7: Components are Documented</h3>
<p>All NEMS system components (e.g. model components, physics library components, workflow components) should have general documentation, user documentation, technical documentation, and, as applicable, scientific references. We define general documentation to include at least a high-level description of the software and its purpose. User documentation includes how to checkout, build and run but not necessarily modify code. Technical documentation is intended for people who need to understand, develop, and change technical code.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposesd by OAS-COLA</p>
<p><b>Reason</b>:</p>
<p>User documentation should include how to checkout, compile, install, configure, run, and analyze outputs of the system. This includes information on how to perform common tasks, such as changing model grids and resolutions. Installation documentation should include detailed itemization of supported compiler(s) (version(s)), MPI implementation(s) (version(s)), batch system(s) and operating system(s). It should also include a step-by-step description for installation of dependent libraries (e.g. ESMF) and data sets.</p>
<p><b>Status</b>:</p>
<p>Initial survey completed.</p>
<h3>D8: Documentation Versioned with Code</h3>
<p>Scientific, user, and technical documentation should be clearly associated with a version of code. This can be done in a maintainable manner via documentation generation tools.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: Versioning is critical for understanding and accuracy.</p>
<p><b>Status</b>: Implementation started.</p>
<h2>Tools and Options: Preparation of Documentation </h2>
<h3>Doxygen</h3>
<p>This is a popular package used by HWRF. Here is one Doxygen example:</p>
<ul>
<li><a href="http://www.dtcenter.org/HurrWRF/users/support/hwrf_docx/html/index.html">http://www.dtcenter.org/HurrWRF/users/support/hwrf_docx/html/index.html</a></li>
</ul>
<p>The HWRF developers website is at</p>
<ul>
<li><a href="http://www.dtcenter.org/HurrWRF/developers">http://www.dtcenter.org/HurrWRF/developers</a></li>
</ul>
<p>By clicking on the various tabs on the left, you can get to the code management document (which basically is a top SVN repo with all 8 components pulled in as SVN externals, similar to the proposed NEMS structure). Links to various documentation, including some created with DOxygen, Latex, and Word are at <a href="http://www.dtcenter.org/HurrWRF/users/docs">http://www.dtcenter.org/HurrWRF/users/docs</a>.</p>
<h3>Protex</h3>
<p>This is a Perl script developed at NASA, used by ESMF, NASA, CESM and other modeling and infrastructure groups. There is a copy included in the ESMF source:</p>
<ul>
<li><a href="http://sourceforge.net/p/esmf/esmf/ci/master/tree/scripts/doc_templates/templates/protex">http://sourceforge.net/p/esmf/esmf/ci/master/tree/scripts/doc_templates/templates/protex</a></li>
</ul>
<p>Protex commands are placed within comments in source code files. These commands extract and format sections of the source and embed them in latex documents. This is used to generate documentation of APIs, code examples, etc. This documentation is updated automatically as the source code evolves, which satisfies requirements such as D4. An example is the ESMF Reference Manual - all of the Class API sections are pulled from the source code using Protex:</p>
<ul>
<li><a href="http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node1.html">http://www.earthsystemmodeling.org/esmf_releases/public/last/ESMF_refdoc/node1.html</a></li>
</ul>
<p>Its main advantage is that it is very simple and easy to understand and customize, and it creates both text and web documents. Disadvantages are that it is plain-looking, especially on the web, and creating web pages requires latex2html or similar.</p>
<h3>Sphinx</h3>
<p>Sphinx is a Python-based package that creates documentation that is more polished-looking than Protex. The ESMF team is using it to document its ESMPy and OpenClimateGIS packages.</p>
<h2>Documentation Current Practice and Recommended Evolution </h2>
<dl class="section note"><dt>Note</dt><dd>Management review is required for the approach to developing and maintaining technical documentation. An approach is also needed for organizing documentation overall.</dd></dl>
<p>A procedure has been proposed by the NEMS documentation lead, Valbona Kunkel.</p>
<p>At the current time, an outline of the documentation that is available and desired for NEMS and its applications is being collected on <a href="https://docs.google.com/spreadsheets/d/1CLT66uzJrjrsY-um0jB5hU-Gfeh3_VCIJDA4-Ibmu5s/edit#gid=0">this spreadsheet</a>. The spreadsheet serves as a survey and gap analysis, and is intended as a first step in the assembly of comprehensive, accessible NEMS documentation. Next steps may include:</p>
<ul>
<li>disseminate the spreadsheet NGGPS-wide so that other can identify additional documentation needed or available</li>
<li>develop strategies for linking code with documentation to satisfy D4</li>
<li>restructure and organize documentation into documents and on websites so that it is increasingly standardized and easier to find</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Move spreadsheet to public area if needed.</dd></dl>
<h1>Input Data Management </h1>
<h2>Goals, Requirements and Expectations </h2>
<dl class="section note"><dt>Note</dt><dd>In the chart below, OP stands for Operating Principles.</dd></dl>
<h3>ID1: Maintain a single source of input data</h3>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, avoid duplication.</p>
<p><b>Status</b>: No policy in place.</p>
<h3>ID2: Minimize the chances of inadvertent modification of input data.</h3>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, formalize sharing.</p>
<p><b>Status</b>: Not implemented.</p>
<h3>ID3: Easy to Identify and Obtain Input Data for a Configuration</h3>
<p>Make it as easy as possible to identify what input data is required for a configuration and to obtain that data and copy it to a new location.</p>
<p><b>Type</b>: Goal</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, engage through clarity..</p>
<p><b>Status</b>: Not implemented.</p>
<h3>ID4: Input Data Not in Personal Directories</h3>
<p>Input data should be held in project and shared directories or repositories and not in personal directories.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: OP, formalize sharing.</p>
<p><b>Status</b>: Not implemented.</p>
<h3>ID5: Verifiable Input Data</h3>
<p>A timestamp or checksum approach should be adopted for input data files to help avoid confusion when files are updated.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: None</p>
<p><b>Status</b>: Not implemented</p>
<h3>ID6 Metadata provenance should be standardized for input data</h3>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: None</p>
<p><b>Status</b>: Not implemented.</p>
<h2>Input Data Management Current Practice and Recommended Evolution </h2>
<dl class="section note"><dt>Note</dt><dd>This section requires management review and concurrence.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This section contains incorrect or incomplete information, and should be ignored until it is updated.</dd></dl>
<p>A proposal for interim NEMS data management is included below. The motivation for implementing such an interim strategy is to satisfy the input data design goals above during development of NEMS applications. These requirements are not satisfied by the current ad hoc approach, which slows down and can disrupt development.</p>
<h3>Standard NEMS Data Dir</h3>
<p>On each system that we support, we determine a location for a "public" NEMS data directory. This data directory is shared by all different compsets, and revisions of them. In other words, if you are on Theia, you know where this data directory lives, and same on yellowstone. Any input files used by NEMS is located within this data dir. Symbolic links are allowed within the data dir.</p>
<p>The location of the platform specific NEMS data dir is hard-coded into the NEMSCompsetRun and documented. It is in general not to be changed.</p>
<p>In subsequent sections the NEMS data dir will be referred to as NEMSDATADIR.</p>
<h3>Compset subdirs</h3>
<p>The first sub directory level under NEMSDATADIR will reflect the compsets that we support. So for example there will be a 20150401_nems_gsm_cice_mom5 subdir.</p>
<h3>Version subdirs</h3>
<p>Under each compset subdir, there will be subdirs that indicate versioning, like v001, v002, ... so on. This level is used by each compset independent of other compsets to handle the fact that input data (and regression output) will change during development.</p>
<h3>Component subdirs</h3>
<p>The final subdir structure contains a subdir for each component that is part of the compset. E.g. for 20150401_nems_gsm_cice_mom5 looks like this:</p>
<ul>
<li>NEMS (mediator files)</li>
<li>GSM</li>
<li>CICE</li>
<li>MOM5</li>
<li>REGRESSION_BASELINE</li>
</ul>
<p>Finally, the NEMSCompsetRun will copy files in the above subdirs to the RUNDIR when setting up the run. Except for GSM, where we are still depending on the native scripts, but we point them to files in the GSM subdir.</p>
<p>Once the above is implemented and documented, it should be more straightforward to set up the input files for a specific compset, or version thereof. The directory structure depends on the compset name, and the version number. Once those two pieces are known, everything else is fixed, which means that the software knows what to do, and a user can easily figure out where to look to find the files.</p>
<h1>Output Data Management </h1>
<dl class="section note"><dt>Note</dt><dd>This section requires management review and concurrence. Preparation of a plan for the estimation, storage and sharing of outputs by the community is one of the actions identified in the CDDM workshop on Sept 1-2, 2016 ("Community Data Access Plan").</dd>
<dd>
Link to the Community Data Access Plan document</dd></dl>
<h2>Goals, Requirements and Expectations </h2>
<p>In the chart below, OP stands for Operating Principles.</p>
<h3>OD1: Model Outputs Available to Non-EMC Developers</h3>
<p>Model outputs must be available on a platform that is open to developers and analysts collaborating with EMC.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: COLA</p>
<p><b>Reason</b>: OP, avoid duplication.</p>
<p><b>Status</b>: No policy in place.</p>
<h3>OD2: Use Standard Data Formats</h3>
<p>Model outputs should be suitable for analysis by the usual tools (eg. NCL, GrADS, Python-based tools) That implies that they must use standard data formats (netCDF, GRIB) and possibly satisfy CF-compliance or even ESGF-compliance.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: OAS/COLA</p>
<p><b>Reason</b>: OP, formalize sharing.</p>
<p><b>Status</b>: Not implemented.</p>
<h3>OD3: Model Outputs in Single Space or Transparently Connected Spaces</h3>
<p>Model outputs should be stored in a single space, or easily/transparently connected multiple spaces.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b>: Ease of analysis.</p>
<p><b>Status</b>: Not implemented.</p>
<h3>OD4: Metadata with Model Outputs</h3>
<p>Model outputs must be stored with metadata sufficient to reproduce the runs that generated them.</p>
<p><b>Type</b>: Requirement</p>
<p><b>Source</b>: Proposed by OAS</p>
<p><b>Reason</b> Ease of analysis.</p>
<p><b>Status</b> Not implemented.</p>
<h2>Output Data Management Current Practice and Recommended Evolution </h2>
<p>This is a proposal for the organization of common UCGS Seasonal results repository. The intent is to facilitate the exchange of information and ideas and to evaluate the evolution of the coupled system in its many configurations. As with other large scale coupled system projects, such as CMIP5, a certain minimum amount of organization is needed and can quickly become overwhelming in its structure. In CMIP5 mostly unprocessed model output is provided. Here, even if adequate space can be found, some further processing will also be needed to reduce repeated processing by individuals and speed getting out key points and ideas. Thus while this will start with a similar structure to CMIP5, some key distinctions will arise:</p>
<ul>
<li>Any model or processed data need not comply with the strict CMIP5 requirements, but must still have enough metadata so that non-proprietary software can examine it. Since models being used here produce some form of GRIB or NetCDF, this should be enough provided the metadata are accurate.</li>
<li>Some reduction in the 4-dimensional domain (space + time) will usually be needed on a per variable basis to aid in examination. Vector and tensor components could be stored jointly for easier display and calculation.</li>
<li>In addition to data graphs, charts, maps and pictures and animations can also be separately included. All should be viewable with standard browser software.</li>
</ul>
<p>Results organization will follow CMIP5 notation at the top level with individual realms each getting a separate directory. Here a realm refers to an entire portion of the climate system an is usually associated with at least one modeling component. At present the land realm is found within the atmosphere model component, but may eventually be separated. Other applications, such a regional forecasts, could have a similar division. The same realm may have several separate model components, such as MOM and HYCOM for the ocean. Additional adjunct components such as atmosphere chemistry or space weather, should have their results placed in the appropriate realm for now. These may be separated later if needed. In addition to the four standard CMIP5 directories of atmosphere, ocean, land and sea ice, a fifth multipurpose directory, labeled X, has also been added. This will be detailed later. Figure 2 shows the basic top level arrangement.</p>
<p>The arrangement of items within each of the first four directories will be similar. The atmosphere directory will be detailed as an example.</p>
<div class="image">
<img src="cmip5-arrangement.png" alt="cmip5-arrangement.png"/>
<div class="caption">
Figure 2</div></div>
<p> As with CMIP5 the next level will be variable. This will permit easier comparison of the same variable from different experiments. Since each variable can be examined in many ways and since some reduction of the model data will be done to further assist in the examination, some added directory levels are needed. Typically as mentioned some domain reduction is done. This will often be some sample or simple average of the 4-dimensional data to 2 dimensions. This would consist of individual levels (atmospheric pressure, height, model level, potential temperature, etc.) or surface (ground, top of atmosphere, etc.), some cross section, usually in latitude or longitude, or some time evolution with a single spatial coordinate. Within each of these basic 2-d slices, further reduction may be done. For horizontal slices, global or different regional reductions can be done. Further down, instantaneous samples or some time averaging combinations can down. Within each of these results from different revisions would be placed. These revisions, representing highly specific model configurations and full input and output dataset and setting, can consist of any combination of data, graphs, charts, maps or animations. Similar reductions would be possible with the other subdomains.</p>
<p>Ideally the placement of the results from the same variable and revision in different directories would be uniquely named so that if copied from the repository, they can be identified as to what they are.</p>
<p>When analysis requires statistics of the one variable beyond the simple slicing and averaging, a directory parallel to the subdomain directory will contain these results. These would include statistics between revisions. In addition to the graphs, charts, maps and animations a separate directory for tabular data is present. This could include Excel files or comma separated variables (.csv) files to allow spreadsheet examination. If needed, a subdomain directory could also be included here for assist in arranging results. Similarly, parallel to all the variable directories is a multivariate statistical directory to examine covariances and similar multivariate relationships. It would be arranged similar to the univariate directories. Figure 3 shows an idea of how these directories are related.</p>
<div class="image">
<img src="directory-idea.png" alt="directory-idea.png"/>
<div class="caption">
Figure 3</div></div>
<p>The multipurpose (X) directory has been added to deal with some special needs:</p>
<ul>
<li>E(X)change of data between realms (components). This would include input and output fields from the mediator, plus the same fields as seen by the components if needed. These would at least start with the unprocessed fields for human review. Problem fields and locations could be highlighted with suitable graphics. As with the other realms, individual variables would be held plus any statistics.</li>
<li>Results from cross(X)-realm evaluations would also be placed here. This would include such plots as atmosphere height correlated with SST anomaly.</li>
<li>To expedite getting information out when a suitable pre-specified directory cannot be determined, a temporary directory (or perhaps permanent if truly unclassifiable) can be set up here to place results of unknown (X) assignment.</li>
</ul>
<h1>Release Management for NEMS Applications </h1>
<p>This is a checklist of tasks for preparing a new release of a NEMS Application. A release includes making available a revision (and tag) of a NEMS Application as well as accompanying documentation.</p>
<h3>Preparing the Snapshot Revision</h3>
<ol type="1">
<li>Ensure regression tests are passing in all affected applications. Changes to common infrastructure such as the Mediator, NEMSAppBuilder and NEMSCompsetRun scripts affect multiple applications.</li>
<li><p class="startli">Prepare the snapshot revision by strictly versioning all svn:externals:</p>
<p class="startli">a. In your application root directory edit the local svn:externals property, strictly versioning all constituent components (including NEMS itself). To determine the strict revision numbers, go into the directory of each component, execute svn info and find the last change revision number.</p>
<p class="startli">b. <code>"$ svn propedit svn:exernals ."</code> </p>
<p class="startli">c. Commit these application svn:externals changes (and potentially other changes in the *.appBuilder or *.compsetRun files) back to the application repo. Take note of the revision number of this commit. This is the revision number of the snapshot revision of the application.</p>
<p class="startli">d. Optionally "svn copy" the application trunk (to which you just committed) to the application tags directory with a descriptive tag name.</p>
<p class="startli">e. Starting with this step, the rest of the steps ensure that your development sandbox (and those of others, when they execute svn update) is reset to no longer use strict versioning. Edit the local svn:externals property, setting all constituent components to float back to the head of their appropriate branch.</p>
<p class="startli">f. Commit the new svn:externals and update. Those checking out the trunk of the NEMS application will receive the head of the development branches of all constituent components. Development continues in this mode until it's time to make another snapshot.</p>
</li>
</ol>
<h2>Steps for Component NUOPC Caps </h2>
<ol type="1">
<li>If the development involved any <a href="https://www.earthsystemcog.org/projects/esps/">Earth System Prediction Suite</a> components, and during the development for the release changes were made to the NUOPC cap, or if a new version of the model was used, then it should be documented in the ESPS tables. Ideally, this would include any new test reports, compliance output, and an updated description of the cap. See HYCOM as an example in the <a href="https://www.earthsystemcog.org/projects/esps/ocean_models">ocean components table</a></li>
<li>Updated components and their NUOPC caps should be pushed back to their home repository, and those revision numbers documented. Since revision numbers are repository specific, a component and its cap will have multiple revision numbers, one associated with each repository. In addition, components with a NUOPC cap included in the source distribution that have been formally released will have a version number, e.g., 2.1. In general, precisely documenting revision numbers and versions ensures that someone else can get the exact same code and reproduce previous results.</li>
</ol>
<h2>Preparing the Release Documentation </h2>
<dl class="section warning"><dt>Warning</dt><dd>This section is incorrect. It does not reflect the fact that documentation has been moved to the repository.</dd></dl>
<p>Note: CoG pages are public documents. They can be locked so that only project members can view a page. A policy should be set as to when the pages below are made public.</p>
<ol type="1">
<li><p class="startli">Create a new milestone release page, currently on the CoupledNEMS CoG site. Examples of these include <a href="http://cog-esgf.esrl.noaa.gov/projects/couplednems/drev58214">UGCS-Seasonal 0.1</a> and <a href="http://cog-esgf.esrl.noaa.gov/projects/couplednems/regional02">Regional 0.2</a>. Here are the key content pieces that should be documented:</p>
<p class="startli">a. A description of the milestone b. The version of each component used. ESPS components should be linked to the component in the <a href="https://www.earthsystemcog.org/projects/esps/">ESPS tables</a>. c. The model grid of each component d. Initial conditions used e. All coupling field exchanges - this should be done by updating the <a href="https://docs.google.com/spreadsheets/d/1X8ByKHfuHZ5x8Ta3Tqv7B0gQBRDXYMK6_yr9tmFu0QE/edit#gid=0">master field spreadsheet</a> and making a copy of it at a new URL to freeze it. Link the copied spreadsheet to the milestone page. f. The run sequence g. How the system was validated, including any plots h. Limitations of the system</p>
</li>
<li><p class="startli">Update (or create) the Build &amp; Run page for the application. Examples of these include <a href="http://cog-esgf.esrl.noaa.gov/projects/couplednems/ugcs-seasonal">UGCS-Seasonal</a> and <a href="http://cog-esgf.esrl.noaa.gov/projects/couplednems/regional">Regional</a>.</p>
<p class="startli">a. Add an entry to the revisions table. Since this revision is an actual release, link the revision number and/or tag to the milestone release page (above). b. The details column should list, in bullet form, changes since the last release (if there was a previous release) or a description of the new application's features if there was no previous release. c. List all compsets that can be run in the released version</p>
</li>
<li>Prepare a release announcement email including a brief description of the milestone release and links to the milestone release page and the Build &amp; Run page for the application.</li>
<li>All documentation should be reviewed and approved before sending out the release notification. The review should start a minimum of two weeks before the intended release date.</li>
<li>Create a CoG news item on the CoupledNEMS site.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Move master field spreadsheet to repo</dd></dl>
<h1>Pilot Projects </h1>
<h2>NEMS Mediator in CIME </h2>
<p>One of the features of the NUOPC software architecture is that the mediator becomes an exchangeable component like an atmosphere or an ocean model. Like those components, it is possible for the mediator to be used in different coupled modeling applications.</p>
<p>As described in the earlier Modes of Use section, it is advantageous to enable coupled NEMS-based modeling applications to be run by the community both within and outside of operational workflows. Including the NEMS mediator in CIME will enable a broad community to construct modeling applications using the NEMS mediator within the mature, accessible, widely used research environment developed by CESM for many-component coupled modeling. Components may include community models with NUOPC interfaces, such as HYCOM, MOM5 and CICE. They may also include model components from CESM, which shares many of the same types of components anticipated in NEMS (atmosphere, ocean, sea ice, land surface, wave, etc.), and NUOPC-compliant components from other centers.The NEMS mediator could be exercised in a wide variety of configurations and predictive time scales, and developed as a community component, with the scrutiny, increased robustness, and access to innovation that implies. A benefit of the collaboration for EMC is CIME’s relationship to a community with established research activities, expertise and outreach in many-component coupled modeling.</p>
<p>Importantly, the standard NUOPC component interfaces on the mediator and model components maintain a link back to the operational system at EMC, ensuring that as advances are made they are accessible to operations.</p>
<p>Figure 4 shows the kinds of infrastructure that would accompany the NEMS mediator in the CIME repository. CIME enables the user to download and begin running a complete standalone coupled test system, where the test components can be replaced by active components with compliant interfaces.</p>
<p>Specific tasks (FY16) include:</p>
<ol type="1">
<li>With direction from NOAA leadership, implement NOAA Environmental Modeling Center (EMC) requirements for code distribution of the NEMS mediator via CIME. This is anticipated to include a download registration page and a plan for monitoring for requests for code access originating from ITAR proscribed countries.</li>
<li>In collaboration with EMC and teams involved with NEMS development, establish a working, documented test system using the NEMS mediator with CIME data models and testing infrastructure. Demonstrate its use with a limited set of active components.</li>
</ol>
<div class="image">
<img src="cime-nems-mediator.png" alt="cime-nems-mediator.png"/>
<div class="caption">
Figure 4</div></div>
 <h2>VLab Pilot Project </h2>
<p>EMC is beginning to install EMC software in the NCEP/EMC subversion repository under VLab to enable community collaboration. Mark Potts is leading this effort. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
