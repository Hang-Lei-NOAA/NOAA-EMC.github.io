<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>NEMS: Step 5. Build, Run and Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">master@eee10ef0fe</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_how_to_old_to_new_build_run.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Step 5. Build, Run and Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Step 5.1: </h2>
<p>Try to build your component. To do this, make sure to run the proper command for your shell. To find out which shell you are using: </p><pre class="fragment">echo $0
</pre><p>In tcsh: </p><pre class="fragment">./NEMS/NEMSAppBuilder app=coupledGSM_WW3 &gt;&amp; coupledbuild.log &amp;
</pre><p>In bash or ksh: </p><pre class="fragment">./NEMS/NEMSAppBuilder app=coupledGSM_WW3 &gt; coupledbuild.log 2&gt;&amp;1 &amp;
</pre><p>Alternatively, you could use the GUI mode: </p><pre class="fragment">./NEMS/NEMSAppBuilder
</pre><p>Make sure you select your new app (coupledGSM_WW3 in our case) You can find more detailed information on the AppBuilder here</p>
<p>You will be able to tell your build was successful by looking to see if the NEMS.x executable exists in the NEMS/exe folder. The coupledbuild.log will give you information about the build to look for errors if the executable is not built successfully.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000032">Todo:</a></b></dt><dd>link to the help for build not running </dd></dl>
<h2>Step 5.2: </h2>
<p>Now try to run your compset. From your top level directory: </p><pre class="fragment">./NEMS/NEMSCompsetRun -f
</pre><p>For more information on the NEMSCompsetRun see <a class="el" href="building.html">Compiling: NEMSAppBuilder and GNUmakefile</a></p>
<h2>Step 5.3: </h2>
<p>Hopefully, the system is now running. For this example you can see where the app is at the following tag:</p><ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Weather/tags/NEMSTutorial/StepLast">https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Weather/tags/NEMSTutorial/StepLast</a></li>
</ul>
<p>If you would like you can try this app: </p><pre class="fragment">$svn co https://svnemc.ncep.noaa.gov/projects/nems/apps/UGCS-Weather/tags/NEMSTutorial/StepLast UpAppEx
$cd UpAppEx 
$./NEMS/NEMSCompsetRun -f 
</pre><p>All options for the NEMSCompsetRun can be found at <a class="el" href="building.html">Compiling: NEMSAppBuilder and GNUmakefile</a></p>
<p>The above command should then gives the following output:</p>
<pre class="fragment">$ ./NEMS/NEMSCompsetRun -f
06/19 12:33:17Z NEMSCompsetRun-INFO:  Test suite subset = *
06/19 12:33:17Z NEMSCompsetRun-INFO:  Starting: exe('account_params')
06/19 12:33:17Z NEMSCompsetRun-INFO:    - and will capture output.
Processing Unix group file /etc/group
Processing Allocation file /home/admin/userdb/theia_allocations.csv
06/19 12:33:25Z NEMSCompsetRun-INFO:  Auto-chosen project for job submission is 'fv3-cpu'
06/19 12:33:25Z NEMSCompsetRun-INFO:  Auto-chosen ptmp is '/scratch4/NCEPDEV/stmp4/Jessica.Meixner'
06/19 12:33:25Z NEMSCompsetRun-INFO:  Parsing compset descriptions.
06/19 12:33:25Z NEMSCompsetRun-INFO:  Verifying repo fingerprint against data fingerprint.
06/19 12:33:25Z NEMSCompsetRun-INFO:  Baseline fingerprint matches repo fingerprint. Rejoice.
06/19 12:33:25Z NEMSCompsetRun-INFO:    Baseline fingerprint file: /scratch4/NCEPDEV/nems/noscrub/emc.nemspara/RT/UGCS-Weather/UpdateStructure-20170531/REGTEST-FINGERPRINT.md
06/19 12:33:25Z NEMSCompsetRun-INFO:    Repository fingerprint file: /scratch4/NCEPDEV/nems/noscrub/Jessica.Meixner/StepLast/parm/REGTEST-FINGERPRINT.md
06/19 12:33:25Z NEMSCompsetRun-INFO:  Generating workflow with id 60503.
06/19 12:33:25Z NEMSCompsetRun-INFO:  Requested test has been generated.
06/19 12:33:25Z rtrun INFO: check dependencies and submit jobs...
06/19 12:33:26Z rtrun INFO: check status...
06/19 12:33:26Z rtrun INFO: workflow is still running and no jobs have failed.
06/19 12:33:26Z rtrun INFO: sleep 2
06/19 12:33:28Z rtrun INFO: get queue information
 Job ID   Reserv.     Queue    Procs ST Queue Time  Stdout Location
-------- -------- ------------ ----- -- ----------- ------------------------------------
25340171          batch            1 Q  06/19 12:33 /scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/build_gsm_ww3.x.log
From qstat -x  job list (age 0 sec.)
06/19 12:33:28Z rtrun INFO: sleep 100
From qstat -x  job list (age 0 sec.)
06/19 12:33:28Z rtrun INFO: sleep 100
06/19 12:35:08Z rtrun INFO: check dependencies and submit jobs...
06/19 12:35:09Z rtrun INFO: check status...
06/19 12:35:09Z rtrun INFO: workflow is still running and no jobs have failed.
06/19 12:35:09Z rtrun INFO: sleep 2
06/19 12:35:11Z rtrun INFO: get queue information
 Job ID   Reserv.     Queue    Procs ST Queue Time  Stdout Location
-------- -------- ------------ ----- -- ----------- ------------------------------------
25340171          batch            1 R  06/19 12:33 /scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/build_gsm_ww3.x.log
From qstat -x  job list (age 0 sec.)
06/19 12:35:11Z rtrun INFO: sleep 100
    ...
06/19 12:59:10Z rtrun INFO: check dependencies and submit jobs...
06/19 12:59:10Z rtrun INFO: check status...
06/19 12:59:10Z rtrun INFO: workflow is still running and no jobs have failed.
06/19 12:59:11Z rtrun INFO: sleep 2
06/19 12:59:13Z rtrun INFO: get queue information
 Job ID   Reserv.     Queue    Procs ST Queue Time  Stdout Location
-------- -------- ------------ ----- -- ----------- ------------------------------------
25340210          debug           60 R  06/19 12:48 /scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/test_cfsr@20150401_1day_blocked_gsm@slg@T126_ww3@t188.log
From qstat -x  job list (age 0 sec.)
06/19 12:59:13Z rtrun INFO: sleep 100
06/19 13:00:53Z rtrun INFO: check dependencies and submit jobs...
06/19 13:00:53Z rtrun INFO: check status...
06/19 13:00:53Z rtrun INFO: workflow is still running and no jobs have failed.
06/19 13:00:54Z rtrun INFO: sleep 2
06/19 13:00:56Z rtrun INFO: get queue information
 Job ID   Reserv.     Queue    Procs ST Queue Time  Stdout Location
-------- -------- ------------ ----- -- ----------- ------------------------------------
25340210          debug           60 R  06/19 12:48 /scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/test_cfsr@20150401_1day_blocked_gsm@slg@T126_ww3@t188.log
From qstat -x  job list (age 0 sec.)
06/19 13:00:56Z rtrun INFO: sleep 100
06/19 13:02:36Z rtrun INFO: check dependencies and submit jobs...
06/19 13:02:36Z rtrun INFO: check status...
06/19 13:02:36Z rtrun INFO: workflow is complete and all jobs succeeded.
06/19 13:02:37Z NEMSCompsetRun-INFO:  generate report
06/19 13:02:37Z NEMSCompsetRun-INFO:  copy build logs to /scratch4/NCEPDEV/nems/noscrub/Jessica.Meixner/StepLast/NEMS/tests/../../log/report-theia-log
Report says test succeeded.
TEST RESULT: PASS
</pre><p>Note from this we can see which queue (project), where the output directory will be: the ptmp directory, the workflow id and more. This also gives you links to the log files of the different parts of the execution.</p>
<p>In this case, the log file for the build is <code>/scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/build_gsm_ww3.x.log</code> and the logfile for the compset is <code>/scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/log/test_cfsr@20150401_1day_blocked_gsm@slg@T126_ww3@t188.log</code>. The output of each compset is located in the <code>tmp/&lt;compsetname&gt;</code> directory, so for this case it would be: <code>/scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/tmp/cfsr@20150401_1day_blocked_gsm@slg@T126_ww3@t188</code>.</p>
<p>For general information about the generated work directories and workflow see: </p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000033">Todo:</a></b></dt><dd>link to description of regtest output folder/workflow directores. </dd></dl>
<p>If your compset fails, you can rerun the compset by going to the workflow directory, in this case: <code>/scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/</code> and rewinding the job, with the following command: </p><pre class="fragment">./rtrewind &lt;compset name&gt; 
</pre><p>For more information on rtrewind, see: </p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000034">Todo:</a></b></dt><dd>link do doc on rtrewind </dd></dl>
<p>Then, go back to your source code directory, and resume the job. This requires knowing the path to your workflow directory. Again in this case the workflow directory is <code>/scratch4/NCEPDEV/stmp4/Jessica.Meixner/rtgen.60503/</code>. The command is: </p><pre class="fragment">./NEMS/NEMSCompsetRun --resume &lt;path to workflow directory&gt; 
</pre><p>If your compset fails, some things to look for:</p>
<ul>
<li>Is it just because your baseline data does not exist or is not in the right location?</li>
<li>Are all variables set in the compset and in the run_exglobal_fcst section?</li>
<li>Are you using the new versions of your branches?</li>
<li>Double check that all old changes were migrated to new branches.</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000035">Todo:</a></b></dt><dd>other items to add here? </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000036">Todo:</a></b></dt><dd>how to run a subset of the all.input based on the keywords </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000037">Todo:</a></b></dt><dd>can you run the workflow without a terminal open? </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000038">Todo:</a></b></dt><dd>is there an option to only run one compset? </dd></dl>
<h2>Step 5.4: </h2>
<p>Add documentation for your application; this should include a basic description of your application and any other application specific infromation you think should be included. Note documentation of individual compsets occurs within the compsets themselves. Put this documentation in the <code>app/doc/README.md</code>. Additional files can be added, but the <code>README.md</code> is the main page. For this application the documentation is simply the following:</p>
<pre class="fragment">UGCS-Weather Application
========================
This site documents the UGCS Weather application, which
is for coupling ATM&lt;-&gt;WAV models.
The available components for ATM is GSM and for WAV
is WAVEWATCH III.
The goal is to determine the impact of including
sea-state dependent feedback from the WAV model on
both the ATM and WAV models.</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
